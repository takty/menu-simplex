{"mappings":"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","sources":["<anon>","src/simplex.ts"],"sourcesContent":["(function () {\n\"use strict\";\nwindow[\"menu_simplex\"] = function(id = null) {\n    new $27b97d93ca8d2b69$var$MenuSimplex(id);\n};\nclass $27b97d93ca8d2b69$var$Item {\n    li;\n    btn;\n    popup;\n    width;\n    constructor(li, btn, popup, width){\n        this.li = li;\n        this.btn = btn;\n        this.popup = popup;\n        this.width = width;\n        this.li = li;\n        this.btn = btn;\n        this.popup = popup;\n        this.width = width;\n    }\n}\nclass $27b97d93ca8d2b69$var$MenuSimplex {\n    static NS = \"menu-simplex\";\n    static CP_IS_FOLDABLE = \"--is-foldable\";\n    static CP_IS_CLOSED_AUTO = \"--is-closed-auto\";\n    static CP_IS_BG_FIXED = \"--is-background-fixed\";\n    static CP_IS_REVERSED = \"--is-reversed\";\n    static CP_FOLDER_POS = \"--folder-position\";\n    static CLS_FOLDER = \"folder\";\n    static CLS_CURRENT = \"current\";\n    static CLS_READY = \"ready\";\n    static CLS_HOVER = \"hover\";\n    static CLS_HOVER_ANCESTOR = \"hover-ancestor\";\n    static CLS_ACTIVE = \"active\";\n    static CLS_OPENED = \"opened\";\n    static CP_MAX_WIDTH = \"--max-width\";\n    static throttle(fn) {\n        let isRunning;\n        function run() {\n            isRunning = false;\n            fn();\n        }\n        return ()=>{\n            if (isRunning) return;\n            isRunning = true;\n            requestAnimationFrame(run);\n        };\n    }\n    static addHoverStateEventListener(root, elms) {\n        const enter = (e)=>{\n            const li = e.target.parentElement;\n            if (li && e.pointerType === \"mouse\" && !li.classList.contains($27b97d93ca8d2b69$var$MenuSimplex.CLS_CURRENT)) {\n                li.classList.add($27b97d93ca8d2b69$var$MenuSimplex.CLS_HOVER);\n                for(let elm = li.parentElement; elm && elm !== root; elm = elm.parentElement)if (elm.tagName === \"LI\") elm.classList.add($27b97d93ca8d2b69$var$MenuSimplex.CLS_HOVER_ANCESTOR);\n            }\n        };\n        const leave = (e)=>{\n            const li = e.target.parentElement;\n            if (li && e.pointerType === \"mouse\" && !li.classList.contains($27b97d93ca8d2b69$var$MenuSimplex.CLS_CURRENT)) {\n                li.classList.remove($27b97d93ca8d2b69$var$MenuSimplex.CLS_HOVER);\n                for(let elm = li.parentElement; elm && elm !== root; elm = elm.parentElement)if (elm.tagName === \"LI\") elm.classList.remove($27b97d93ca8d2b69$var$MenuSimplex.CLS_HOVER_ANCESTOR);\n            }\n        };\n        for (const it of elms){\n            const fec = it.firstElementChild;\n            if (fec) {\n                fec.addEventListener(\"pointerenter\", enter);\n                fec.addEventListener(\"pointerleave\", leave);\n            }\n        }\n    }\n    static fixed;\n    static fixBackground(enabled) {\n        if ($27b97d93ca8d2b69$var$MenuSimplex.fixed === enabled) return;\n        $27b97d93ca8d2b69$var$MenuSimplex.fixed = enabled;\n        const scrollingElement = ()=>{\n            return \"scrollingElement\" in document ? document.scrollingElement : document.documentElement;\n        };\n        const se = scrollingElement();\n        if (!se) return;\n        const sy = enabled ? se.scrollTop : parseInt(document.body.style.top ?? \"0\");\n        const cs = getComputedStyle(document.body);\n        const mw = parseFloat(cs.marginInlineStart) + parseFloat(cs.marginInlineEnd);\n        const ss = {\n            position: \"fixed\",\n            top: `${-sy}px`,\n            left: \"0\",\n            width: `calc(100vw - ${mw}px)`,\n            height: \"100dvh\",\n            \"overflow-y\": \"scroll\"\n        };\n        for (const [key, value] of Object.entries(ss))document.body.style[key] = enabled ? value : \"\";\n        if (!enabled) window.scrollTo(0, -sy);\n    }\n    static getStylePropertyBool(elm, prop) {\n        const v = getComputedStyle(elm).getPropertyValue(prop).trim();\n        if (!v.length) return null;\n        if (typeof v !== \"string\") return Boolean(v);\n        try {\n            return \"true\" == JSON.parse(v.toLowerCase());\n        } catch (e) {\n            return v.length !== 0;\n        }\n    }\n    static getStylePropertyString(elm, prop) {\n        const v = getComputedStyle(elm).getPropertyValue(prop).trim().replace(new RegExp('^\"+|\"+$', \"g\"), \"\");\n        if (!v.length) return null;\n        return typeof v === \"string\" ? v : String(v);\n    }\n    #divRoot;\n    #ulBar;\n    #ulFld;\n    #liFocusTrap;\n    #fldIdx;\n    #scrollY = 0;\n    #curIts = [];\n    #skipResize = false;\n    constructor(id = null){\n        const divRoot = id ? document.getElementById(id) : document.getElementsByClassName($27b97d93ca8d2b69$var$MenuSimplex.NS)[0];\n        if (!divRoot) throw new DOMException();\n        this.#divRoot = divRoot;\n        this.#ulBar = this.#divRoot.getElementsByTagName(\"ul\")[0];\n        if (!this.#ulBar) throw new DOMException();\n        [this.#ulFld, this.#fldIdx] = this.initFolder();\n        const its = this.initBarItems();\n        this.initPopup(its);\n        const order = this.initOrder(its);\n        this.#liFocusTrap = this.initFocusTrap();\n        const allLis = Array.from(this.#ulBar.querySelectorAll(\"li\"));\n        $27b97d93ca8d2b69$var$MenuSimplex.addHoverStateEventListener(this.#divRoot, allLis);\n        setTimeout(()=>{\n            const ro = new ResizeObserver(()=>requestAnimationFrame(()=>{\n                    if (this.#skipResize) {\n                        this.#skipResize = false;\n                        return;\n                    }\n                    this.closeAll(its);\n                    this.alignItems(its, order);\n                }));\n            ro.observe(this.#divRoot);\n            ro.observe(this.#divRoot.parentElement);\n        }, 10);\n        setTimeout(()=>this.#divRoot.classList.add($27b97d93ca8d2b69$var$MenuSimplex.CLS_READY), 100);\n    }\n    initFolder() {\n        let li = null;\n        let idx = 0;\n        for (const e of Array.from(this.#ulBar.children)){\n            if (e.classList.contains($27b97d93ca8d2b69$var$MenuSimplex.CLS_FOLDER)) {\n                li = e;\n                break;\n            }\n            idx += 1;\n        }\n        if (!li) {\n            li = document.createElement(\"li\");\n            li.classList.add($27b97d93ca8d2b69$var$MenuSimplex.CLS_FOLDER);\n            const pos = $27b97d93ca8d2b69$var$MenuSimplex.getStylePropertyString(this.#divRoot, $27b97d93ca8d2b69$var$MenuSimplex.CP_FOLDER_POS);\n            if (null === pos || \"end\" === pos) {\n                this.#ulBar.append(li);\n                idx = this.#ulBar.children.length - 1;\n            } else if (\"start\" === pos) {\n                this.#ulBar.prepend(li);\n                idx = 0;\n            }\n        }\n        let btn = li.querySelector(\":scope > button\");\n        if (!btn) {\n            btn = document.createElement(\"button\");\n            li.appendChild(btn);\n        }\n        let ul = li.querySelector(\":scope > button + ul, :scope > button + * > ul\");\n        if (!ul) {\n            ul = document.createElement(\"ul\");\n            ul.classList.add(\"menu\");\n            li.appendChild(ul);\n        }\n        return [\n            ul,\n            idx\n        ];\n    }\n    initBarItems() {\n        const its = [];\n        const lis = Array.from(this.#ulBar.querySelectorAll(\":scope > li\"));\n        for (const li of lis){\n            const btn = li.querySelector(\":scope > button\");\n            const popup = btn?.nextElementSibling;\n            const width = li.offsetWidth;\n            its.push(new $27b97d93ca8d2b69$var$Item(li, btn, popup, width));\n        }\n        return its;\n    }\n    initPopup(its) {\n        for (const it of its){\n            const { li: li, btn: btn, popup: popup } = it;\n            if (!btn || !popup) continue;\n            btn.setAttribute(\"area-expanded\", \"false\");\n            if (!popup.id) {\n                const id = btn.id ? btn.id : li.id ? li.id : \"\";\n                if (id) popup.id = id + \"-sub\";\n            }\n            if (popup.id) btn.setAttribute(\"area-controls\", popup.id);\n            btn.addEventListener(\"click\", (e)=>{\n                if (btn.classList.contains($27b97d93ca8d2b69$var$MenuSimplex.CLS_OPENED)) this.close(it);\n                else {\n                    if (this.#ulBar === li.parentElement) this.closeAll(its, btn);\n                    this.open(it);\n                }\n                e.stopPropagation();\n            });\n        }\n        window.addEventListener(\"keydown\", (e)=>{\n            if (e.key === \"Escape\") {\n                if (this.#curIts.length) {\n                    const { btn: btn } = this.#curIts[this.#curIts.length - 1];\n                    if (btn) {\n                        btn.focus();\n                        btn.click();\n                    }\n                }\n            }\n        });\n        if (true === $27b97d93ca8d2b69$var$MenuSimplex.getStylePropertyBool(this.#divRoot, $27b97d93ca8d2b69$var$MenuSimplex.CP_IS_CLOSED_AUTO)) {\n            document.addEventListener(\"DOMContentLoaded\", ()=>{\n                window.addEventListener(\"scroll\", $27b97d93ca8d2b69$var$MenuSimplex.throttle(()=>this.doOnScroll(its)), {\n                    passive: true\n                });\n            });\n            document.addEventListener(\"click\", ()=>this.closeAll(its));\n        }\n    }\n    initOrder(its) {\n        const ws = new Array(its.length);\n        for(let i = 0; i < its.length; i += 1){\n            const { li: li } = its[i];\n            ws[i] = this.getWeightFromClass(li, its.length - i);\n        }\n        const order = new Array(its.length);\n        for(let i = 0; i < its.length; i += 1)order[i] = i;\n        order.sort((a, b)=>ws[a] < ws[b] ? 1 : ws[a] > ws[b] ? -1 : 0);\n        if (true === $27b97d93ca8d2b69$var$MenuSimplex.getStylePropertyBool(this.#divRoot, $27b97d93ca8d2b69$var$MenuSimplex.CP_IS_REVERSED)) order.reverse();\n        return order;\n    }\n    getWeightFromClass(li, def) {\n        const cs = li.className.split(\" \");\n        let w = null;\n        for (const c of cs){\n            const n = parseInt(c, 10);\n            if (isNaN(n)) continue;\n            if (null === w || w < n) w = n;\n        }\n        return w ?? def;\n    }\n    initFocusTrap() {\n        const e = document.createElement(\"li\");\n        e.className = \"focus-trap\";\n        e.tabIndex = 0;\n        e.addEventListener(\"focus\", ()=>{\n            if (this.#curIts.length) {\n                const { btn: btn } = this.#curIts[0];\n                if (btn) btn.focus();\n            }\n        });\n        return e;\n    }\n    open(it) {\n        const { li: li, btn: btn, popup: popup } = it;\n        if (!btn || !popup) return;\n        li.classList.add($27b97d93ca8d2b69$var$MenuSimplex.CLS_OPENED);\n        btn.classList.add($27b97d93ca8d2b69$var$MenuSimplex.CLS_OPENED);\n        btn.setAttribute(\"area-expanded\", \"true\");\n        popup.classList.add($27b97d93ca8d2b69$var$MenuSimplex.CLS_ACTIVE);\n        setTimeout(()=>popup.classList.add($27b97d93ca8d2b69$var$MenuSimplex.CLS_OPENED), 0);\n        this.#curIts.push(it);\n        popup.style.transform = \"\";\n        if (this.#curIts[0].popup) this.adjustPopupInline(this.#curIts[0].popup);\n        this.#scrollY = window.scrollY;\n        if (1 === this.#curIts.length) {\n            const ul = \"UL\" === popup.tagName ? popup : popup.getElementsByClassName(\"UL\")?.[0];\n            if (ul) ul.appendChild(this.#liFocusTrap);\n        }\n        if (true === $27b97d93ca8d2b69$var$MenuSimplex.getStylePropertyBool(this.#divRoot, $27b97d93ca8d2b69$var$MenuSimplex.CP_IS_BG_FIXED)) {\n            this.#skipResize = true;\n            $27b97d93ca8d2b69$var$MenuSimplex.fixBackground(true);\n        }\n    }\n    adjustPopupInline(popup) {\n        popup.style.transform = \"\";\n        popup.style.maxWidth = \"\";\n        let pr = popup.getBoundingClientRect();\n        const rr = this.#divRoot.getBoundingClientRect();\n        if (rr.width < pr.width) {\n            popup.style.maxWidth = `${rr.width}px`;\n            pr = popup.getBoundingClientRect();\n        }\n        if (rr.right < pr.right) popup.style.transform = `translateX(${rr.right - pr.right}px)`;\n        if (pr.left < rr.left) popup.style.transform = `translateX(${pr.left - rr.left}px)`;\n    }\n    close(it) {\n        const { li: li, btn: btn, popup: popup } = it;\n        if (!btn || !popup) return;\n        li.classList.remove($27b97d93ca8d2b69$var$MenuSimplex.CLS_OPENED);\n        btn.classList.remove($27b97d93ca8d2b69$var$MenuSimplex.CLS_OPENED);\n        btn.setAttribute(\"area-expanded\", \"false\");\n        popup.classList.remove($27b97d93ca8d2b69$var$MenuSimplex.CLS_OPENED);\n        setTimeout(()=>{\n            popup.classList.remove($27b97d93ca8d2b69$var$MenuSimplex.CLS_ACTIVE);\n            if (this.#curIts.length) {\n                const { popup: popup } = this.#curIts[0];\n                if (popup) this.adjustPopupInline(popup);\n            }\n        }, 200);\n        this.#curIts.pop();\n        if (0 === this.#curIts.length) {\n            const ul = \"UL\" === popup.tagName ? popup : popup.getElementsByClassName(\"UL\")?.[0];\n            if (ul && this.#liFocusTrap.parentElement === ul) ul.removeChild(this.#liFocusTrap);\n        }\n        if ($27b97d93ca8d2b69$var$MenuSimplex.getStylePropertyBool(this.#divRoot, $27b97d93ca8d2b69$var$MenuSimplex.CP_IS_BG_FIXED)) {\n            this.#skipResize = true;\n            $27b97d93ca8d2b69$var$MenuSimplex.fixBackground(false);\n        }\n    }\n    closeAll(its, opening = null) {\n        if (!this.#curIts.length) return;\n        for (const it of its){\n            const { btn: btn } = it;\n            if (btn && opening !== btn) this.close(it);\n        }\n        this.#curIts.length = 0;\n        if ($27b97d93ca8d2b69$var$MenuSimplex.getStylePropertyBool(this.#divRoot, $27b97d93ca8d2b69$var$MenuSimplex.CP_IS_BG_FIXED)) {\n            this.#skipResize = true;\n            $27b97d93ca8d2b69$var$MenuSimplex.fixBackground(false);\n        }\n    }\n    doOnScroll(its) {\n        if (!this.#curIts.length || !this.#curIts[0].popup) return;\n        const bcr = this.#curIts[0].popup.getBoundingClientRect();\n        if (bcr.bottom < 0 || 0 < bcr.top && bcr.bottom < Math.abs(window.scrollY - this.#scrollY)) this.closeAll(its);\n    }\n    alignItems(its, order) {\n        this.setMaxWidth();\n        const inBar = this.calcItemPlace(its, order);\n        if (false === $27b97d93ca8d2b69$var$MenuSimplex.getStylePropertyBool(this.#divRoot, $27b97d93ca8d2b69$var$MenuSimplex.CP_IS_FOLDABLE)) {\n            inBar.fill(true);\n            inBar[this.#fldIdx] = false;\n        }\n        its[this.#fldIdx].li.style.display = inBar[this.#fldIdx] ? \"\" : \"none\";\n        let prevElm = this.#ulBar.firstChild;\n        for(let i = 0; i < its.length; i += 1){\n            const { li: li } = its[i];\n            if (inBar[i]) {\n                if (li.parentElement === this.#ulBar) its[i].width = li.offsetWidth;\n                this.#ulBar.insertBefore(li, prevElm.nextElementSibling);\n                prevElm = li;\n            } else if (i !== this.#fldIdx) this.#ulFld.appendChild(li);\n        }\n    }\n    setMaxWidth() {\n        const p = this.#divRoot.parentElement;\n        if (p) {\n            const s = getComputedStyle(p);\n            const w = p.clientWidth - (parseFloat(s.paddingLeft) + parseFloat(s.paddingRight));\n            this.#divRoot.style.setProperty($27b97d93ca8d2b69$var$MenuSimplex.CP_MAX_WIDTH, `${Math.floor(w)}px`);\n        }\n    }\n    calcItemPlace(its, order) {\n        const inBar = new Array(its.length);\n        const gap = this.calcBarGap();\n        const sumW = its.reduce((s, v)=>s + v.width, 0) + gap * (its.length - 1) - (its[this.#fldIdx].width + gap);\n        let barW = this.calcBarWidth();\n        if (barW < sumW) {\n            barW -= its[this.#fldIdx].width;\n            inBar[this.#fldIdx] = true;\n            for (const idx of order)if (idx !== this.#fldIdx) {\n                barW -= its[idx].width + gap;\n                inBar[idx] = 0 <= barW;\n            }\n        } else {\n            inBar.fill(true);\n            inBar[this.#fldIdx] = false;\n        }\n        return inBar;\n    }\n    calcBarWidth() {\n        this.#ulBar.style.width = \"0\";\n        let w = Math.floor(this.#divRoot.getBoundingClientRect().width);\n        if (0 === w && this.#divRoot.parentElement) {\n            const s = getComputedStyle(this.#divRoot.parentElement);\n            if (s.display.endsWith(\"flex\")) {\n                this.#divRoot.style.flexGrow = \"1\";\n                w = Math.floor(this.#divRoot.getBoundingClientRect().width);\n                this.#divRoot.style.flexGrow = \"\";\n            }\n        }\n        this.#ulBar.style.width = \"\";\n        return w;\n    }\n    calcBarGap() {\n        const s = getComputedStyle(this.#ulBar);\n        const g = parseInt(s.columnGap, 10);\n        return Number.isNaN(g) ? 0 : g;\n    }\n}\n\n})();\n//# sourceMappingURL=simplex.js.map\n","/**\n * Menu Simplex (Progressively collapsing menu)\n *\n * @author Takuto Yanagida\n * @version 2023-09-24\n */\n\n(window as any)['menu_simplex'] = function (id: string|null = null) {\n\tnew MenuSimplex(id);\n};\n\nclass Item {\n\tconstructor(public li:HTMLElement, public btn:HTMLElement|null, public popup:HTMLElement|null, public width: number) {\n\t\tthis.li    = li;\n\t\tthis.btn   = btn;\n\t\tthis.popup = popup;\n\t\tthis.width = width;\n\t}\n}\n\nclass MenuSimplex {\n\n\tstatic NS = 'menu-simplex';\n\n\tstatic CP_IS_FOLDABLE    = '--is-foldable';\n\tstatic CP_IS_CLOSED_AUTO = '--is-closed-auto';\n\tstatic CP_IS_BG_FIXED    = '--is-background-fixed';\n\tstatic CP_IS_REVERSED    = '--is-reversed';\n\tstatic CP_FOLDER_POS     = '--folder-position';\n\n\tstatic CLS_FOLDER  = 'folder';\n\tstatic CLS_CURRENT = 'current';\n\n\tstatic CLS_READY          = 'ready';\n\tstatic CLS_HOVER          = 'hover';\n\tstatic CLS_HOVER_ANCESTOR = 'hover-ancestor';\n\tstatic CLS_ACTIVE         = 'active';\n\tstatic CLS_OPENED         = 'opened';\n\n\tstatic CP_MAX_WIDTH = '--max-width';\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tstatic throttle(fn: Function): () => void {\n\t\tlet isRunning: boolean;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\n\tstatic addHoverStateEventListener(root: HTMLElement, elms: HTMLElement[]) {\n\t\tconst enter = (e: PointerEvent) => {\n\t\t\tconst li = (e.target as HTMLElement).parentElement;\n\n\t\t\tif (li && e.pointerType === 'mouse' && !li.classList.contains(MenuSimplex.CLS_CURRENT)) {\n\t\t\t\tli.classList.add(MenuSimplex.CLS_HOVER);\n\t\t\t\tfor (let elm = li.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\tif (elm.tagName === 'LI') {\n\t\t\t\t\t\telm.classList.add(MenuSimplex.CLS_HOVER_ANCESTOR);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst leave = (e: PointerEvent) => {\n\t\t\tconst li = (e.target as HTMLElement).parentElement;\n\n\t\t\tif (li && e.pointerType === 'mouse' && !li.classList.contains(MenuSimplex.CLS_CURRENT)) {\n\t\t\t\tli.classList.remove(MenuSimplex.CLS_HOVER);\n\t\t\t\tfor (let elm = li.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\tif (elm.tagName === 'LI') {\n\t\t\t\t\t\telm.classList.remove(MenuSimplex.CLS_HOVER_ANCESTOR);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const it of elms) {\n\t\t\tconst fec = it.firstElementChild as HTMLElement;\n\t\t\tif (fec) {\n\t\t\t\tfec.addEventListener('pointerenter', enter);\n\t\t\t\tfec.addEventListener('pointerleave', leave);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic fixed: boolean;\n\n\tstatic fixBackground(enabled: boolean) {\n\t\tif (MenuSimplex.fixed === enabled) return;\n\t\tMenuSimplex.fixed = enabled;\n\n\t\tconst scrollingElement = () => {\n\t\t\treturn ('scrollingElement' in document) ? document.scrollingElement : (<Document>document).documentElement;\n\t\t};\n\t\tconst se = scrollingElement();\n\t\tif (!se) return;\n\t\tconst sy = enabled ? se.scrollTop : parseInt(document.body.style.top ?? '0');\n\t\tconst cs = getComputedStyle(document.body);\n\t\tconst mw = parseFloat(cs.marginInlineStart) + parseFloat(cs.marginInlineEnd);\n\t\tconst ss = {\n\t\t\tposition: 'fixed',\n\t\t\ttop     : `${-sy}px`,\n\t\t\tleft    : '0',\n\t\t\twidth   : `calc(100vw - ${mw}px)`,\n\t\t\theight  : '100dvh',\n\n\t\t\t'overflow-y': 'scroll',  // For keeping scroll bar width.\n\t\t};\n\t\tfor (const [key, value] of Object.entries(ss)) {\n\t\t\t(document.body.style as any)[key] = enabled ? value : '';\n\t\t}\n\t\tif (!enabled) {\n\t\t\twindow.scrollTo(0, -sy);\n\t\t}\n\t}\n\n\tstatic getStylePropertyBool(elm: HTMLElement, prop: string): boolean|null {\n\t\tconst v = getComputedStyle(elm).getPropertyValue(prop).trim();\n\t\tif (!v.length) return null;\n\t\tif (typeof v !== 'string') return Boolean(v);\n\t\ttry {\n\t\t\treturn 'true' == JSON.parse(v.toLowerCase());\n\t\t} catch(e) {\n\t\t\treturn v.length !== 0;\n\t\t}\n\t}\n\n\tstatic getStylePropertyString(elm: HTMLElement, prop: string): string|null {\n\t\tconst v = getComputedStyle(elm).getPropertyValue(prop).trim().replace(new RegExp('^\\\"+|\\\"+$', 'g'), '');\n\t\tif (!v.length) return null;\n\t\treturn (typeof v === 'string') ? v : String(v);\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t#divRoot: HTMLElement;\n\t#ulBar: HTMLElement;\n\t#ulFld: HTMLElement;\n\t#liFocusTrap: HTMLElement;\n\n\t#fldIdx: number;\n\n\t#scrollY: number = 0;\n\t#curIts: Item[] = [];\n\n\t#skipResize: boolean = false;\n\n\tconstructor(id: string|null = null) {\n\t\tconst divRoot = id ? document.getElementById(id) : document.getElementsByClassName(MenuSimplex.NS)[0];\n\t\tif (!divRoot) throw new DOMException();\n\t\tthis.#divRoot = divRoot as HTMLElement;\n\t\tthis.#ulBar = this.#divRoot.getElementsByTagName('ul')[0];\n\t\tif (!this.#ulBar) throw new DOMException();\n\n\t\t[this.#ulFld, this.#fldIdx] = this.initFolder();\n\t\tconst its = this.initBarItems();\n\t\tthis.initPopup(its);\n\t\tconst order = this.initOrder(its);\n\t\tthis.#liFocusTrap = this.initFocusTrap();\n\n\t\tconst allLis = Array.from(this.#ulBar.querySelectorAll('li'));\n\t\tMenuSimplex.addHoverStateEventListener(this.#divRoot, allLis);\n\n\t\tsetTimeout(() => {\n\t\t\tconst ro = new ResizeObserver(\n\t\t\t\t() => requestAnimationFrame(() => {\n\t\t\t\t\tif (this.#skipResize) {\n\t\t\t\t\t\tthis.#skipResize = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.closeAll(its);\n\t\t\t\t\tthis.alignItems(its, order);\n\t\t\t\t})\n\t\t\t);\n\t\t\tro.observe(this.#divRoot);\n\t\t\tro.observe(this.#divRoot.parentElement as HTMLElement);\n\t\t}, 10);\n\t\tsetTimeout(() => this.#divRoot.classList.add(MenuSimplex.CLS_READY), 100);\n\t}\n\n\tinitFolder(): [HTMLElement, number] {\n\t\tlet li: HTMLElement|null = null;\n\t\tlet idx = 0;\n\t\tfor (const e of Array.from(this.#ulBar.children)) {\n\t\t\tif (e.classList.contains(MenuSimplex.CLS_FOLDER)) {\n\t\t\t\tli = e as HTMLElement;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tidx += 1;\n\t\t}\n\t\tif (!li) {\n\t\t\tli = document.createElement('li');\n\t\t\tli.classList.add(MenuSimplex.CLS_FOLDER);\n\n\t\t\tconst pos = MenuSimplex.getStylePropertyString(this.#divRoot, MenuSimplex.CP_FOLDER_POS);\n\t\t\tif (null === pos || 'end' === pos) {\n\t\t\t\tthis.#ulBar.append(li);\n\t\t\t\tidx = this.#ulBar.children.length - 1;\n\t\t\t} else if ('start' === pos) {\n\t\t\t\tthis.#ulBar.prepend(li);\n\t\t\t\tidx = 0;\n\t\t\t}\n\t\t}\n\t\tlet btn = li.querySelector(':scope > button');\n\t\tif (!btn) {\n\t\t\tbtn = document.createElement('button');\n\t\t\tli.appendChild(btn);\n\t\t}\n\t\tlet ul = li.querySelector(':scope > button + ul, :scope > button + * > ul') as HTMLElement;\n\t\tif (!ul) {\n\t\t\tul = document.createElement('ul');\n\t\t\tul.classList.add('menu');\n\t\t\tli.appendChild(ul);\n\t\t}\n\t\treturn [ul, idx];\n\t}\n\n\tinitBarItems(): Item[] {\n\t\tconst its: Item[] = [];\n\t\tconst lis = Array.from(this.#ulBar.querySelectorAll(':scope > li'));\n\t\tfor (const li of lis) {\n\t\t\tconst btn = li.querySelector(':scope > button');\n\t\t\tconst popup = btn?.nextElementSibling as HTMLElement;\n\t\t\tconst width = (li as HTMLElement).offsetWidth;\n\t\t\tits.push(new Item(li as HTMLElement, btn as HTMLElement, popup, width));\n\t\t}\n\t\treturn its;\n\t}\n\n\tinitPopup(its: Item[]) {\n\t\tfor (const it of its) {\n\t\t\tconst { li, btn, popup } = it;\n\t\t\tif (!btn || !popup) continue;\n\n\t\t\tbtn.setAttribute('area-expanded', 'false');\n\t\t\tif (!popup.id) {\n\t\t\t\tconst id = btn.id ? btn.id : (li.id ? li.id : '');\n\t\t\t\tif (id) {\n\t\t\t\t\tpopup.id = id + '-sub';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (popup.id) {\n\t\t\t\tbtn.setAttribute('area-controls', popup.id);\n\t\t\t}\n\t\t\tbtn.addEventListener('click', e => {\n\t\t\t\tif (btn.classList.contains(MenuSimplex.CLS_OPENED)) {\n\t\t\t\t\tthis.close(it);\n\t\t\t\t} else {\n\t\t\t\t\tif (this.#ulBar === li.parentElement) {\n\t\t\t\t\t\tthis.closeAll(its, btn);\n\t\t\t\t\t}\n\t\t\t\t\tthis.open(it);\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t}\n\t\twindow.addEventListener('keydown', (e) => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tif (this.#curIts.length) {\n\t\t\t\t\tconst { btn } = this.#curIts[this.#curIts.length - 1];\n\t\t\t\t\tif (btn) {\n\t\t\t\t\t\tbtn.focus();\n\t\t\t\t\t\tbtn.click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (true === MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_CLOSED_AUTO)) {\n\t\t\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\t\t\twindow.addEventListener('scroll', MenuSimplex.throttle(() => this.doOnScroll(its)), { passive: true });\n\t\t\t});\n\t\t\tdocument.addEventListener('click', () => this.closeAll(its));\n\t\t}\n\t}\n\n\tinitOrder(its: Item[]): number[] {\n\t\tconst ws = new Array(its.length);\n\t\tfor (let i = 0; i < its.length; i += 1) {\n\t\t\tconst { li } = its[i];\n\t\t\tws[i] = this.getWeightFromClass(li, its.length - i);\n\t\t}\n\t\tconst order = new Array(its.length);\n\t\tfor (let i = 0; i < its.length; i += 1) order[i] = i;\n\t\torder.sort((a: number, b: number) => ws[a] < ws[b] ? 1 : ws[a] > ws[b] ? -1 : 0);\n\n\t\tif (true === MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_REVERSED)) {\n\t\t\torder.reverse();\n\t\t}\n\t\treturn order;\n\t}\n\n\tgetWeightFromClass(li: Element, def: number): number {\n\t\tconst cs = li.className.split(' ');\n\t\tlet w: number|null = null;\n\t\tfor (const c of cs) {\n\t\t\tconst n = parseInt(c, 10);\n\t\t\tif (isNaN(n)) continue;\n\t\t\tif (null === w || w < n) w = n;\n\t\t}\n\t\treturn w ?? def;\n\t}\n\n\tinitFocusTrap(): HTMLElement {\n\t\tconst e = document.createElement('li');\n\t\te.className = 'focus-trap';\n\t\te.tabIndex = 0;\n\t\te.addEventListener('focus', () => {\n\t\t\tif (this.#curIts.length) {\n\t\t\t\tconst { btn } = this.#curIts[0];\n\t\t\t\tif (btn) btn.focus();\n\t\t\t}\n\t\t});\n\t\treturn e;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\topen(it: Item) {\n\t\tconst { li, btn, popup } = it;\n\t\tif (!btn || !popup) return;\n\n\t\tli.classList.add(MenuSimplex.CLS_OPENED);\n\t\tbtn.classList.add(MenuSimplex.CLS_OPENED);\n\t\tbtn.setAttribute('area-expanded', 'true');\n\t\tpopup.classList.add(MenuSimplex.CLS_ACTIVE);\n\n\t\tsetTimeout(() => popup.classList.add(MenuSimplex.CLS_OPENED), 0);\n\t\tthis.#curIts.push(it);\n\n\t\tpopup.style.transform = '';\n\t\tif (this.#curIts[0].popup) {\n\t\t\tthis.adjustPopupInline(this.#curIts[0].popup);\n\t\t}\n\t\tthis.#scrollY = window.scrollY;\n\n\t\tif (1 === this.#curIts.length) {\n\t\t\tconst ul = ('UL' === popup.tagName) ? popup : popup.getElementsByClassName('UL')?.[0];\n\t\t\tif (ul) {\n\t\t\t\tul.appendChild(this.#liFocusTrap);\n\t\t\t}\n\t\t}\n\n\t\tif (true === MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_BG_FIXED)) {\n\t\t\tthis.#skipResize = true;\n\t\t\tMenuSimplex.fixBackground(true);\n\t\t}\n\t}\n\n\tadjustPopupInline(popup: HTMLElement) {\n\t\tpopup.style.transform = '';\n\t\tpopup.style.maxWidth = '';\n\t\tlet pr = popup.getBoundingClientRect();\n\t\tconst rr = this.#divRoot.getBoundingClientRect();\n\t\tif (rr.width < pr.width) {\n\t\t\tpopup.style.maxWidth = `${rr.width}px`;\n\t\t\tpr = popup.getBoundingClientRect();\n\t\t}\n\t\tif (rr.right < pr.right) {\n\t\t\tpopup.style.transform = `translateX(${rr.right - pr.right}px)`;\n\t\t}\n\t\tif (pr.left < rr.left) {\n\t\t\tpopup.style.transform = `translateX(${pr.left - rr.left}px)`;\n\t\t}\n\t}\n\n\tclose(it: Item) {\n\t\tconst { li, btn, popup } = it;\n\t\tif (!btn || !popup) return;\n\n\t\tli.classList.remove(MenuSimplex.CLS_OPENED);\n\t\tbtn.classList.remove(MenuSimplex.CLS_OPENED);\n\t\tbtn.setAttribute('area-expanded', 'false');\n\t\tpopup.classList.remove(MenuSimplex.CLS_OPENED);\n\n\t\tsetTimeout(() => {\n\t\t\tpopup.classList.remove(MenuSimplex.CLS_ACTIVE);\n\t\t\tif (this.#curIts.length) {\n\t\t\t\tconst { popup } = this.#curIts[0];\n\t\t\t\tif (popup) this.adjustPopupInline(popup);\n\t\t\t}\n\t\t}, 200);\n\t\tthis.#curIts.pop();\n\n\t\tif (0 === this.#curIts.length) {\n\t\t\tconst ul = ('UL' === popup.tagName) ? popup : popup.getElementsByClassName('UL')?.[0];\n\t\t\tif (ul && this.#liFocusTrap.parentElement === ul) {\n\t\t\t\tul.removeChild(this.#liFocusTrap);\n\t\t\t}\n\t\t}\n\n\t\tif (MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_BG_FIXED)) {\n\t\t\tthis.#skipResize = true;\n\t\t\tMenuSimplex.fixBackground(false);\n\t\t}\n\t}\n\n\tcloseAll(its: Item[], opening: HTMLElement|null = null) {\n\t\tif (!this.#curIts.length) return;\n\n\t\tfor (const it of its) {\n\t\t\tconst { btn } = it;\n\t\t\tif (btn && opening !== btn) {\n\t\t\t\tthis.close(it);\n\t\t\t}\n\t\t}\n\t\tthis.#curIts.length = 0;\n\n\t\tif (MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_BG_FIXED)) {\n\t\t\tthis.#skipResize = true;\n\t\t\tMenuSimplex.fixBackground(false);\n\t\t}\n\t}\n\n\tdoOnScroll(its: Item[]) {\n\t\tif (!this.#curIts.length || !this.#curIts[0].popup) {\n\t\t\treturn;\n\t\t}\n\t\tconst bcr = this.#curIts[0].popup.getBoundingClientRect();\n\t\tif (\n\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.scrollY - this.#scrollY))  // When fixed\n\t\t) {\n\t\t\tthis.closeAll(its);\n\t\t}\n\t}\n\n\talignItems(its: Item[], order: number[]) {\n\t\tthis.setMaxWidth();\n\t\tconst inBar = this.calcItemPlace(its, order);\n\n\t\tif (false === MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_FOLDABLE)) {\n\t\t\tinBar.fill(true);\n\t\t\tinBar[this.#fldIdx] = false;\n\t\t}\n\t\tits[this.#fldIdx].li.style.display = inBar[this.#fldIdx] ? '' : 'none';\n\n\t\tlet prevElm = this.#ulBar.firstChild as HTMLElement;\n\t\tfor (let i = 0; i < its.length; i += 1) {\n\t\t\tconst { li } = its[i];\n\t\t\tif (inBar[i]) {\n\t\t\t\tif (li.parentElement === this.#ulBar) {\n\t\t\t\t\tits[i].width = li.offsetWidth;\n\t\t\t\t}\n\t\t\t\tthis.#ulBar.insertBefore(li, prevElm.nextElementSibling);\n\t\t\t\tprevElm = li;\n\t\t\t} else if(i !== this.#fldIdx) {\n\t\t\t\tthis.#ulFld.appendChild(li);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetMaxWidth() {\n\t\tconst p = this.#divRoot.parentElement;\n\t\tif (p) {\n\t\t\tconst s = getComputedStyle(p);\n\t\t\tconst w = p.clientWidth - (parseFloat(s.paddingLeft) + parseFloat(s.paddingRight));\n\t\t\tthis.#divRoot.style.setProperty(MenuSimplex.CP_MAX_WIDTH, `${Math.floor(w)}px`);\n\t\t}\n\t}\n\n\tcalcItemPlace(its: Item[], order: number[]): boolean[] {\n\t\tconst inBar = new Array(its.length);\n\n\t\tconst gap  = this.calcBarGap();\n\t\tconst sumW = its.reduce((s: number, v: Item) => s + v.width, 0) + (gap * (its.length - 1)) - (its[this.#fldIdx].width + gap);\n\t\tlet barW   = this.calcBarWidth();\n\n\t\tif (barW < sumW) {\n\t\t\tbarW -= its[this.#fldIdx].width;\n\t\t\tinBar[this.#fldIdx] = true;\n\n\t\t\tfor (const idx of order) {\n\t\t\t\tif (idx !== this.#fldIdx) {\n\t\t\t\t\tbarW -= its[idx].width + gap;\n\t\t\t\t\tinBar[idx] = (0 <= barW);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tinBar.fill(true);\n\t\t\tinBar[this.#fldIdx] = false;\n\t\t}\n\t\treturn inBar;\n\t}\n\n\tcalcBarWidth(): number {\n\t\tthis.#ulBar.style.width = '0';\n\t\tlet w = Math.floor(this.#divRoot.getBoundingClientRect().width);\n\n\t\tif (0 === w && this.#divRoot.parentElement) {\n\t\t\tconst s = getComputedStyle(this.#divRoot.parentElement);\n\t\t\tif (s.display.endsWith('flex')) {\n\t\t\t\tthis.#divRoot.style.flexGrow = '1';\n\t\t\t\tw = Math.floor(this.#divRoot.getBoundingClientRect().width);\n\t\t\t\tthis.#divRoot.style.flexGrow = '';\n\t\t\t}\n\t\t}\n\n\t\tthis.#ulBar.style.width = '';\n\t\treturn w;\n\t}\n\n\tcalcBarGap(): number {\n\t\tconst s = getComputedStyle(this.#ulBar);\n\t\tconst g = parseInt(s.columnGap, 10);\n\t\treturn Number.isNaN(g) ? 0 : g;\n\t}\n\n}\n"],"names":["window","id","$27b97d93ca8d2b69$var$MenuSimplex","$27b97d93ca8d2b69$var$Item","li","btn","popup","width","constructor","NS","CP_IS_FOLDABLE","CP_IS_CLOSED_AUTO","CP_IS_BG_FIXED","CP_IS_REVERSED","CP_FOLDER_POS","CLS_FOLDER","CLS_CURRENT","CLS_READY","CLS_HOVER","CLS_HOVER_ANCESTOR","CLS_ACTIVE","CLS_OPENED","CP_MAX_WIDTH","throttle","fn","isRunning","run","requestAnimationFrame","addHoverStateEventListener","root","elms","enter","e","target","parentElement","pointerType","classList","contains","add","elm","tagName","leave","remove","it","fec","firstElementChild","addEventListener","fixed","fixBackground","enabled","se","document","scrollingElement","documentElement","sy","scrollTop","parseInt","body","style","top","cs","getComputedStyle","mw","parseFloat","marginInlineStart","marginInlineEnd","ss","position","left","height","key","value","Object","entries","scrollTo","getStylePropertyBool","prop","v","getPropertyValue","trim","length","Boolean","JSON","parse","toLowerCase","getStylePropertyString","replace","RegExp","String","divRoot","ulBar","ulFld","liFocusTrap","fldIdx","scrollY","curIts","skipResize","getElementById","getElementsByClassName","getElementsByTagName","DOMException","initFolder","its","initBarItems","initPopup","order","initOrder","initFocusTrap","allLis","Array","from","querySelectorAll","setTimeout","ro","ResizeObserver","closeAll","alignItems","observe","idx","children","createElement","pos","append","prepend","querySelector","appendChild","ul","lis","nextElementSibling","offsetWidth","push","setAttribute","close","open","stopPropagation","focus","click","doOnScroll","passive","ws","i","getWeightFromClass","sort","a","b","reverse","def","className","split","w","c","n","isNaN","tabIndex","transform","adjustPopupInline","maxWidth","pr","getBoundingClientRect","rr","right","pop","removeChild","opening","bcr","bottom","Math","abs","setMaxWidth","inBar","calcItemPlace","fill","display","prevElm","firstChild","insertBefore","p","s","clientWidth","paddingLeft","paddingRight","setProperty","floor","gap","calcBarGap","sumW","reduce","barW","calcBarWidth","endsWith","flexGrow","g","columnGap","Number"],"version":3,"file":"simplex.js.map"}