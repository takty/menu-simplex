"use strict";export class MenuSimplex{static NS="menu-simplex";static CP_IS_FOLDABLE="--is-foldable";static CP_IS_CLOSED_AUTO="--is-closed-auto";static CP_IS_BG_FIXED="--is-background-fixed";static CP_IS_REVERSED="--is-reversed";static CP_FOLDER_POS="--folder-position";static CLS_FOLDER="folder";static CLS_CURRENT="current";static CLS_READY="ready";static CLS_HOVER="hover";static CLS_HOVER_ANCESTOR="hover-ancestor";static CLS_ACTIVE="active";static CLS_OPENED="opened";static CP_MAX_WIDTH="--max-width";static throttle(t){let n;function e(){n=!1,t()}return()=>{n||(n=!0,requestAnimationFrame(e))}}static addHoverStateEventListener(t,n){const e=i=>{const l=i.target.parentElement;if(l&&i.pointerType==="mouse"&&!l.classList.contains(MenuSimplex.CLS_CURRENT)){l.classList.add(MenuSimplex.CLS_HOVER);for(let o=l.parentElement;o&&o!==t;o=o.parentElement)o.tagName==="LI"&&o.classList.add(MenuSimplex.CLS_HOVER_ANCESTOR)}},s=i=>{const l=i.target.parentElement;if(l&&i.pointerType==="mouse"&&!l.classList.contains(MenuSimplex.CLS_CURRENT)){l.classList.remove(MenuSimplex.CLS_HOVER);for(let o=l.parentElement;o&&o!==t;o=o.parentElement)o.tagName==="LI"&&o.classList.remove(MenuSimplex.CLS_HOVER_ANCESTOR)}};for(const i of n){const l=i.firstElementChild;l&&(l.addEventListener("pointerenter",e),l.addEventListener("pointerleave",s))}}static fixed;static fixBackground(t){if(MenuSimplex.fixed===t)return;MenuSimplex.fixed=t;const e=(()=>"scrollingElement"in document?document.scrollingElement:document.documentElement)();if(!e)return;const s=t?e.scrollTop:parseInt(document.body.style.top??"0"),i=getComputedStyle(document.body),l=parseFloat(i.marginInlineStart)+parseFloat(i.marginInlineEnd),o={position:"fixed",top:`${-s}px`,left:"0",width:`calc(100vw - ${l}px)`,height:"100dvh","overflow-y":"scroll"};for(const[r,a]of Object.entries(o))document.body.style[r]=t?a:"";t||window.scrollTo(0,-s)}static getStylePropertyBool(t,n){const e=getComputedStyle(t).getPropertyValue(n).trim();if(!e.length)return null;if(typeof e!="string")return!!e;try{return JSON.parse(e.toLowerCase())=="true"}catch{return e.length!==0}}static getStylePropertyString(t,n){const e=getComputedStyle(t).getPropertyValue(n).trim().replace(new RegExp('^"+|"+$',"g"),"");return e.length?typeof e=="string"?e:String(e):null}#t;#s;#o;#l;#n;#r=0;#e=[];#i=!1;constructor(t=null){const n=t?document.getElementById(t):document.getElementsByClassName(MenuSimplex.NS)[0];if(!n)throw new DOMException;if(this.#t=n,this.#s=this.#t.getElementsByTagName("ul")[0],!this.#s)throw new DOMException;this.#t.classList.contains(MenuSimplex.NS)||this.#t.classList.add(MenuSimplex.NS),[this.#o,this.#n]=this.initFolder();const e=this.initBarItems();this.initPopup(e);const s=this.initOrder(e);this.#l=this.initFocusTrap();const i=Array.from(this.#s.querySelectorAll("li"));MenuSimplex.addHoverStateEventListener(this.#t,i),setTimeout(()=>{const l=new ResizeObserver(()=>requestAnimationFrame(()=>{if(this.#i){this.#i=!1;return}this.closeAll(e),this.alignItems(e,s)}));l.observe(this.#t),l.observe(this.#t.parentElement)},10),setTimeout(()=>this.#t.classList.add(MenuSimplex.CLS_READY),100)}initFolder(){let t=null,n=0;for(const i of Array.from(this.#s.children)){if(i.classList.contains(MenuSimplex.CLS_FOLDER)){t=i;break}n+=1}if(!t){t=document.createElement("li"),t.classList.add(MenuSimplex.CLS_FOLDER);const i=MenuSimplex.getStylePropertyString(this.#t,MenuSimplex.CP_FOLDER_POS);i===null||i==="end"?(this.#s.append(t),n=this.#s.children.length-1):i==="start"&&(this.#s.prepend(t),n=0)}let e=t.querySelector(":scope > button");e||(e=document.createElement("button"),t.appendChild(e));let s=t.querySelector(":scope > button + ul, :scope > button + * > ul");return s||(s=document.createElement("ul"),s.classList.add("menu"),t.appendChild(s)),[s,n]}initBarItems(){const t=[],n=Array.from(this.#s.querySelectorAll(":scope > li"));for(const e of n){const s=e.querySelector(":scope > button"),i=s?.nextElementSibling,l=e.offsetWidth;t.push(new c(e,s,i,l))}return t}initPopup(t){for(const n of t){const{li:e,btn:s,popup:i}=n;if(!(!s||!i)){if(s.setAttribute("area-expanded","false"),!i.id){const l=s.id?s.id:e.id?e.id:"";l&&(i.id=l+"-sub")}i.id&&s.setAttribute("area-controls",i.id),s.addEventListener("click",l=>{s.classList.contains(MenuSimplex.CLS_OPENED)?this.close(n):(this.#s===e.parentElement&&this.closeAll(t,s),this.open(n)),l.stopPropagation()})}}window.addEventListener("keydown",n=>{if(n.key==="Escape"&&this.#e.length){const{btn:e}=this.#e[this.#e.length-1];e&&(e.focus(),e.click())}}),MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_CLOSED_AUTO)===!0&&(document.addEventListener("DOMContentLoaded",()=>{window.addEventListener("scroll",MenuSimplex.throttle(()=>this.doOnScroll(t)),{passive:!0})}),document.addEventListener("click",()=>this.closeAll(t)))}initOrder(t){const n=new Array(t.length);for(let s=0;s<t.length;s+=1){const{li:i}=t[s];n[s]=this.getWeightFromClass(i,t.length-s)}const e=new Array(t.length);for(let s=0;s<t.length;s+=1)e[s]=s;return e.sort((s,i)=>n[s]<n[i]?1:n[s]>n[i]?-1:0),MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_REVERSED)===!0&&e.reverse(),e}getWeightFromClass(t,n){const e=t.className.split(" ");let s=null;for(const i of e){const l=parseInt(i,10);isNaN(l)||(s===null||s<l)&&(s=l)}return s??n}initFocusTrap(){const t=document.createElement("li");return t.className="focus-trap",t.tabIndex=0,t.addEventListener("focus",()=>{if(this.#e.length){const{btn:n}=this.#e[0];n&&n.focus()}}),t}open(t){const{li:n,btn:e,popup:s}=t;if(!(!e||!s)){if(n.classList.add(MenuSimplex.CLS_OPENED),e.classList.add(MenuSimplex.CLS_OPENED),e.setAttribute("area-expanded","true"),s.classList.add(MenuSimplex.CLS_ACTIVE),setTimeout(()=>s.classList.add(MenuSimplex.CLS_OPENED),0),this.#e.push(t),s.style.transform="",this.#e[0].popup&&this.adjustPopupInline(this.#e[0].popup),this.#r=window.scrollY,this.#e.length===1){const i=s.tagName==="UL"?s:s.getElementsByClassName("UL")?.[0];i&&i.appendChild(this.#l)}MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)===!0&&(this.#i=!0,MenuSimplex.fixBackground(!0))}}adjustPopupInline(t){t.style.transform="",t.style.maxWidth="";let n=t.getBoundingClientRect();const e=this.#t.getBoundingClientRect();e.width<n.width&&(t.style.maxWidth=`${e.width}px`,n=t.getBoundingClientRect()),e.right<n.right&&(t.style.transform=`translateX(${e.right-n.right}px)`),n.left<e.left&&(t.style.transform=`translateX(${n.left-e.left}px)`)}close(t){const{li:n,btn:e,popup:s}=t;if(!(!e||!s)){if(n.classList.remove(MenuSimplex.CLS_OPENED),e.classList.remove(MenuSimplex.CLS_OPENED),e.setAttribute("area-expanded","false"),s.classList.remove(MenuSimplex.CLS_OPENED),setTimeout(()=>{if(s.classList.remove(MenuSimplex.CLS_ACTIVE),this.#e.length){const{popup:i}=this.#e[0];i&&this.adjustPopupInline(i)}},200),this.#e.pop(),this.#e.length===0){const i=s.tagName==="UL"?s:s.getElementsByClassName("UL")?.[0];i&&this.#l.parentElement===i&&i.removeChild(this.#l)}MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)&&(this.#i=!0,MenuSimplex.fixBackground(!1))}}closeAll(t,n=null){if(this.#e.length){for(const e of t){const{btn:s}=e;s&&n!==s&&this.close(e)}this.#e.length=0,MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)&&(this.#i=!0,MenuSimplex.fixBackground(!1))}}doOnScroll(t){if(!this.#e.length||!this.#e[0].popup)return;const n=this.#e[0].popup.getBoundingClientRect();(n.bottom<0||0<n.top&&n.bottom<Math.abs(window.scrollY-this.#r))&&this.closeAll(t)}alignItems(t,n){this.setMaxWidth();const e=this.calcItemPlace(t,n);MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_FOLDABLE)===!1&&(e.fill(!0),e[this.#n]=!1),t[this.#n].li.style.display=e[this.#n]?"":"none";let s=this.#s.firstChild;for(let i=0;i<t.length;i+=1){const{li:l}=t[i];e[i]?(l.parentElement===this.#s&&(t[i].width=l.offsetWidth),this.#s.insertBefore(l,s.nextElementSibling),s=l):i!==this.#n&&this.#o.appendChild(l)}}setMaxWidth(){const t=this.#t.parentElement;if(t){const n=getComputedStyle(t),e=t.clientWidth-(parseFloat(n.paddingLeft)+parseFloat(n.paddingRight));this.#t.style.setProperty(MenuSimplex.CP_MAX_WIDTH,`${Math.floor(e)}px`)}}calcItemPlace(t,n){const e=new Array(t.length),s=this.calcBarGap(),i=t.reduce((o,r)=>o+r.width,0)+s*(t.length-1)-(t[this.#n].width+s);let l=this.calcBarWidth();if(l<i){l-=t[this.#n].width,e[this.#n]=!0;for(const o of n)o!==this.#n&&(l-=t[o].width+s,e[o]=0<=l)}else e.fill(!0),e[this.#n]=!1;return e}calcBarWidth(){this.#s.style.width="0";let t=Math.floor(this.#t.getBoundingClientRect().width);return t===0&&this.#t.parentElement&&getComputedStyle(this.#t.parentElement).display.endsWith("flex")&&(this.#t.style.flexGrow="1",t=Math.floor(this.#t.getBoundingClientRect().width),this.#t.style.flexGrow=""),this.#s.style.width="",t}calcBarGap(){const t=getComputedStyle(this.#s),n=parseInt(t.columnGap,10);return Number.isNaN(n)?0:n}}class c{constructor(t,n,e,s){this.li=t;this.btn=n;this.popup=e;this.width=s;this.li=t,this.btn=n,this.popup=e,this.width=s}}
//# sourceMappingURL=menu-simplex.min.js.map
