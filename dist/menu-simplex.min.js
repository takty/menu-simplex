"use strict";export class MenuSimplex{static NS="menu-simplex";static CLS_PANEL="panel";static CLS_PANEL_POPUP="panel-popup";static CLS_PANEL_MORE="panel-more";static CLS_MENU="menu";static CLS_MENU_BAR="menu-bar";static CLS_MENU_POPUP="menu-popup";static CLS_MENU_MORE="menu-more";static CLS_FOCUS_TRAP="focus-trap";static CLS_DO_WRAP_PANEL="do-wrap-panel";static CP_IS_CLOSED_AUTO="--is-closed-auto";static CP_IS_BG_FIXED="--is-background-fixed";static CP_IS_REVERSED="--is-reversed";static CP_MORE_POS="--more-position";static CP_COLLAPSED="--collapsed";static CLS_MORE="more";static CLS_CURRENT="current";static CLS_READY="ready";static CLS_HOVER="hover";static CLS_HOVER_ANCESTOR="hover-ancestor";static CLS_ACTIVE="active";static CLS_OPENED="opened";static CLS_IS_COLLAPSED="is-collapsed";static CLS_IS_COLLAPSED_ALL="is-collapsed-all";static CLS_IN_BAR="in-bar";static CLS_IN_MORE="in-more";static CP_MAX_WIDTH="--max-width";static throttle(t){let i;function e(){i=!1,t()}return()=>{i||(i=!0,requestAnimationFrame(e))}}static wrapElement(t,i){const e=t.at(0)?.parentNode,n=t.at(-1)?.nextSibling,s=document.createElement(i);for(const l of t)s.appendChild(l);return n?e?.insertBefore(s,n):e?.appendChild(s),s}static addHoverStateEventListener(t,i){const e=s=>{const l=s.target.parentElement;if(l&&s.pointerType==="mouse"&&!l.classList.contains(MenuSimplex.CLS_CURRENT)){l.classList.add(MenuSimplex.CLS_HOVER);for(let r=l.parentElement;r&&r!==t;r=r.parentElement)r.tagName==="LI"&&r.classList.add(MenuSimplex.CLS_HOVER_ANCESTOR)}},n=s=>{const l=s.target.parentElement;if(l&&s.pointerType==="mouse"&&!l.classList.contains(MenuSimplex.CLS_CURRENT)){l.classList.remove(MenuSimplex.CLS_HOVER);for(let r=l.parentElement;r&&r!==t;r=r.parentElement)r.tagName==="LI"&&r.classList.remove(MenuSimplex.CLS_HOVER_ANCESTOR)}};for(const s of i){const l=s.firstElementChild;l&&(l.addEventListener("pointerenter",e),l.addEventListener("pointerleave",n))}}static cancelUnexpectedClose(t){let i=t.target;for(;i&&!i.classList.contains("menu");){if(i.tagName==="A")return;i=i.parentElement}t.stopPropagation()}static fixed;static fixBackground(t){if(MenuSimplex.fixed===t)return;MenuSimplex.fixed=t;const e="scrollingElement"in document?document.scrollingElement:document.documentElement;if(!e)return;const n=t?e.scrollTop:parseInt(document.body.style.top??"0"),s=getComputedStyle(document.body),l=parseFloat(s.marginInlineStart)+parseFloat(s.marginInlineEnd),r={position:"fixed",top:`${-n}px`,left:"0",width:`calc(100vw - ${l}px)`,height:"100dvh","overflow-y":"scroll"};for(const[a,o]of Object.entries(r))document.body.style[a]=t?o:"";t||window.scrollTo(0,-n)}static getStylePropertyBool(t,i){let e=getComputedStyle(t).getPropertyValue(i).trim();if((e.at(0)==='"'&&e.at(-1)==='"'||e.at(0)==="'"&&e.at(-1)==="'")&&(e=e.slice(1,-1)),!e.length)return null;if(typeof e!="string")return!!e;try{return JSON.parse(e.toLowerCase())===!0}catch{return e.length!==0}}static getStylePropertyString(t,i){const e=getComputedStyle(t).getPropertyValue(i).trim().replace(new RegExp('^"+|"+$',"g"),"");return e.length?typeof e=="string"?e:String(e):null}#t;#e;#r;#n;#i;#o=0;#s=[];#l=!1;#a=!1;constructor(t=null){const i=t?document.getElementById(t):document.getElementsByClassName(MenuSimplex.NS)[0];if(!i)throw new DOMException;if(this.#t=i,this.#e=this.#t.getElementsByTagName("ul")[0],!this.#e)throw new DOMException;this.#e.classList.add(MenuSimplex.CLS_MENU,MenuSimplex.CLS_MENU_BAR),this.#t.classList.contains(MenuSimplex.NS)||this.#t.classList.add(MenuSimplex.NS),this.#a=this.#t.classList.contains(MenuSimplex.CLS_DO_WRAP_PANEL),[this.#r,this.#i]=this.initMore();const e=this.initBarItems(this.#r);this.initPanel(e);const n=this.initOrder(e);this.#n=this.initFocusTrap();const s=Array.from(this.#e.querySelectorAll("li"));MenuSimplex.addHoverStateEventListener(this.#t,s);const l=()=>{if(this.#l){this.#l=!1;return}this.closeAll(e),this.alignItems(e,n)};setTimeout(()=>{const r=new ResizeObserver(()=>requestAnimationFrame(l));r.observe(this.#t),r.observe(this.#t.parentElement)},10),setTimeout(()=>this.#t.classList.add(MenuSimplex.CLS_READY),100)}initMore(){let t=null,i=0;for(const r of Array.from(this.#e.children)){if(r.classList.contains(MenuSimplex.CLS_MORE)){t=r;break}i+=1}if(!t){t=document.createElement("li"),t.classList.add(MenuSimplex.CLS_MORE);const r=MenuSimplex.getStylePropertyString(this.#t,MenuSimplex.CP_MORE_POS);r===null||r==="end"?(this.#e.append(t),i=this.#e.children.length-1):r==="start"&&(this.#e.prepend(t),i=0)}let e=t.querySelector(":scope > button");e||(e=document.createElement("button"),e.setAttribute("title","More"),t.insertBefore(e,t.firstChild));const n=t.querySelectorAll(":scope > ul, :scope > div > ul");let s=Array.from(n).find(r=>!r.children.length);if(!s){s=document.createElement("ul");let r=t.querySelector(":scope > div");r?r.appendChild(s):t.appendChild(s)}let l=s.parentElement===t?s:s.parentElement;return this.#a&&l===s&&(l=MenuSimplex.wrapElement(Array.from(t.children).filter(r=>r!==e),"div")),l.classList.add(MenuSimplex.CLS_PANEL,MenuSimplex.CLS_PANEL_MORE),l.addEventListener("click",r=>MenuSimplex.cancelUnexpectedClose(r)),s.classList.add(MenuSimplex.CLS_MENU,MenuSimplex.CLS_MENU_MORE),[s,i]}initBarItems(t){const i=[];for(const e of this.#e.querySelectorAll(":scope > li")){const n=e.querySelector(":scope > button");let s=null,l=null;e.classList.contains(MenuSimplex.CLS_MORE)?(s=t,l=s.parentElement===e?s:s.parentElement):(s=e.querySelector(":scope > ul, :scope > div > ul"),s&&(l=s.parentElement===e?s:s.parentElement,this.#a&&l===s&&(l=MenuSimplex.wrapElement([s],"div")),l.classList.add(MenuSimplex.CLS_PANEL,MenuSimplex.CLS_PANEL_POPUP),l.addEventListener("click",r=>MenuSimplex.cancelUnexpectedClose(r)),s.classList.add(MenuSimplex.CLS_MENU,MenuSimplex.CLS_MENU_POPUP))),i.push(new c(e,n,l,s,0))}return i}initPanel(t){for(const i of t){const{li:e,btn:n,panel:s}=i;if(!(!n||!s)){if(n.setAttribute("area-expanded","false"),!s.id){const l=n.id?n.id:e.id?e.id:"";l&&(s.id=l+"-sub")}s.id&&n.setAttribute("area-controls",s.id),n.addEventListener("click",l=>{n.classList.contains(MenuSimplex.CLS_OPENED)?this.close(i):(this.#e===e.parentElement&&this.closeAll(t,n),this.open(i)),l.stopPropagation()})}}window.addEventListener("keydown",i=>{if(i.key==="Escape"){const e=this.#s.at(-1);if(e){const{btn:n}=e;n&&(n.focus(),n.click())}}}),MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_CLOSED_AUTO)&&(document.addEventListener("DOMContentLoaded",()=>{window.addEventListener("scroll",MenuSimplex.throttle(()=>this.doOnScroll(t)),{passive:!0})}),document.addEventListener("click",()=>this.closeAll(t)))}initOrder(t){const i=MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_REVERSED),e=new Array(t.length);for(let s=0;s<t.length;s+=1){const{li:l}=t[s];e[s]=this.getWeightFromClass(l,i?s:t.length-s)}const n=new Array(t.length);for(let s=0;s<t.length;s+=1)n[s]=s;return n.sort((s,l)=>e[s]<e[l]?1:e[s]>e[l]?-1:0),n}getWeightFromClass(t,i){const e=t.className.split(" ");let n=null;for(const s of e){const l=parseInt(s,10);isNaN(l)||(n===null||n<l)&&(n=l)}return n??i}initFocusTrap(){const t=document.createElement("li");return t.className=MenuSimplex.CLS_FOCUS_TRAP,t.tabIndex=0,t.addEventListener("focus",()=>{if(this.#s.length){const{btn:i}=this.#s[0];i&&i.focus()}}),t}open(t){const{li:i,btn:e,panel:n}=t;!e||!n||(i.classList.add(MenuSimplex.CLS_OPENED),e.classList.add(MenuSimplex.CLS_OPENED),e.setAttribute("area-expanded","true"),n.classList.add(MenuSimplex.CLS_ACTIVE),setTimeout(()=>n.classList.add(MenuSimplex.CLS_OPENED),0),this.#s.push(t),n.style.transform="",this.#s[0].panel&&this.adjustPanelInline(this.#s[0].panel),this.#o=window.scrollY,this.#s.length===1&&(i.classList.contains(MenuSimplex.CLS_MORE)?this.#r.appendChild(this.#n):(n.tagName==="UL"?n:n.getElementsByTagName("ul")?.[0])?.appendChild(this.#n),MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)&&(this.#l=!0,MenuSimplex.fixBackground(!0))))}adjustPanelInline(t){t.style.transform="",t.style.maxWidth="";let i=t.getBoundingClientRect();const e=this.#t.getBoundingClientRect();e.width<i.width&&(t.style.maxWidth=`${e.width}px`,i=t.getBoundingClientRect()),e.right<i.right&&(t.style.transform=`translateX(${e.right-i.right}px)`),i.left<e.left&&(t.style.transform=`translateX(${i.left-e.left}px)`)}close(t){const{li:i,btn:e,panel:n}=t;if(!(!e||!n)&&(i.classList.remove(MenuSimplex.CLS_OPENED),e.classList.remove(MenuSimplex.CLS_OPENED),e.setAttribute("area-expanded","false"),n.classList.remove(MenuSimplex.CLS_OPENED),setTimeout(()=>{if(n.classList.remove(MenuSimplex.CLS_ACTIVE),this.#s.length){const{panel:s}=this.#s[0];s&&this.adjustPanelInline(s)}},200),this.#s.pop(),this.#s.length===0)){const s=n.tagName==="UL"?n:n.getElementsByTagName("ul")?.[0];s&&this.#n.parentElement===s&&s.removeChild(this.#n),MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)&&(this.#l=!0,MenuSimplex.fixBackground(!1))}}closeAll(t,i=null){if(this.#s.length){for(const e of t){const{btn:n}=e;n&&i!==n&&this.close(e)}this.#s.length=0,MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)&&(this.#l=!0,MenuSimplex.fixBackground(!1))}}doOnScroll(t){if(!this.#s.length||!this.#s[0].panel)return;const i=this.#s[0].panel.getBoundingClientRect();(i.bottom<0||0<i.top&&i.bottom<Math.abs(window.scrollY-this.#o))&&this.closeAll(t)}alignItems(t,i){this.setMaxWidth();const e=this.calcItemPlace(t,i);t[this.#i].li.style.display=e[this.#i]?"":"none",this.setCollapsedState(e);const n=(l,r,a)=>{l?.classList.remove(r),l?.classList.add(a)};let s=this.#e.firstChild;for(let l=0;l<t.length;l+=1){const{li:r,panel:a,menu:o}=t[l];e[l]?(r.parentElement===this.#e&&(r.style.flexGrow="0",t[l].width=r.offsetWidth,r.style.flexGrow=""),this.#e.insertBefore(r,s.nextElementSibling),s=r,n(a,MenuSimplex.CLS_IN_MORE,MenuSimplex.CLS_IN_BAR),a!==o&&n(o,MenuSimplex.CLS_IN_MORE,MenuSimplex.CLS_IN_BAR)):l!==this.#i&&(this.#r.appendChild(r),n(a,MenuSimplex.CLS_IN_BAR,MenuSimplex.CLS_IN_MORE),a!==o&&n(o,MenuSimplex.CLS_IN_BAR,MenuSimplex.CLS_IN_MORE))}}setMaxWidth(){const t=this.#t.parentElement;if(t){const i=getComputedStyle(t),e=t.clientWidth-(parseFloat(i.paddingLeft)+parseFloat(i.paddingRight));this.#t.style.setProperty(MenuSimplex.CP_MAX_WIDTH,`${Math.floor(e)}px`)}}setCollapsedState(t){t[this.#i]?this.#t.classList.add(MenuSimplex.CLS_IS_COLLAPSED):this.#t.classList.remove(MenuSimplex.CLS_IS_COLLAPSED),t.every((i,e)=>e===this.#i||!i)?this.#t.classList.add(MenuSimplex.CLS_IS_COLLAPSED_ALL):this.#t.classList.remove(MenuSimplex.CLS_IS_COLLAPSED_ALL)}calcItemPlace(t,i){const e=new Array(t.length);switch(MenuSimplex.getStylePropertyString(this.#t,MenuSimplex.CP_COLLAPSED)){case"never":return e.fill(!0),e[this.#i]=!1,e;case"always":return e.fill(!1),e[this.#i]=!0,e}for(let r=0;r<t.length;r+=1)t[r].width===0&&(t[r].width=t[r].li.offsetWidth);const n=this.calcBarGap(),s=t.reduce((r,a)=>r+a.width,0)+n*(t.length-1)-(t[this.#i].width+n);let l=this.calcBarWidth();if(l<s){l-=t[this.#i].width,e[this.#i]=!0;for(const r of i)r!==this.#i&&(l-=t[r].width+n,e[r]=0<=l)}else e.fill(!0),e[this.#i]=!1;return e}calcBarWidth(){this.#e.style.width="0";let t=Math.floor(this.#t.getBoundingClientRect().width);return t===0&&this.#t.parentElement&&getComputedStyle(this.#t.parentElement).display.endsWith("flex")&&(this.#t.style.flexGrow="1",t=Math.floor(this.#t.getBoundingClientRect().width),this.#t.style.flexGrow=""),this.#e.style.width="",t}calcBarGap(){const t=getComputedStyle(this.#e),i=parseInt(t.columnGap,10);return Number.isNaN(i)?0:i}}class c{constructor(t,i,e,n,s){this.li=t;this.btn=i;this.panel=e;this.menu=n;this.width=s;this.li=t,this.btn=i,this.panel=e,this.menu=n,this.width=s}}
//# sourceMappingURL=menu-simplex.min.js.map
