window.menu_simplex=function(t=null){new e(t)};class t{li;btn;popup;width;constructor(t,e,i,s){this.li=t,this.btn=e,this.popup=i,this.width=s,this.li=t,this.btn=e,this.popup=i,this.width=s}}class e{static NS="menu-simplex";static CP_IS_FOLDABLE="--is-foldable";static CP_IS_CLOSED_AUTO="--is-closed-auto";static CP_IS_BG_FIXED="--is-background-fixed";static CP_IS_REVERSED="--is-reversed";static CP_FOLDER_POS="--folder-position";static CLS_FOLDER="folder";static CLS_CURRENT="current";static CLS_READY="ready";static CLS_HOVER="hover";static CLS_HOVER_ANCESTOR="hover-ancestor";static CLS_ACTIVE="active";static CLS_OPENED="opened";static CP_MAX_WIDTH="--max-width";static throttle(t){let e;function i(){e=!1,t()}return()=>{e||(e=!0,requestAnimationFrame(i))}}static addHoverStateEventListener(t,i){let s=i=>{let s=i.target.parentElement;if(s&&"mouse"===i.pointerType&&!s.classList.contains(e.CLS_CURRENT)){s.classList.add(e.CLS_HOVER);for(let i=s.parentElement;i&&i!==t;i=i.parentElement)"LI"===i.tagName&&i.classList.add(e.CLS_HOVER_ANCESTOR)}},l=i=>{let s=i.target.parentElement;if(s&&"mouse"===i.pointerType&&!s.classList.contains(e.CLS_CURRENT)){s.classList.remove(e.CLS_HOVER);for(let i=s.parentElement;i&&i!==t;i=i.parentElement)"LI"===i.tagName&&i.classList.remove(e.CLS_HOVER_ANCESTOR)}};for(let t of i){let e=t.firstElementChild;e&&(e.addEventListener("pointerenter",s),e.addEventListener("pointerleave",l))}}static fixed;static fixBackground(t){if(e.fixed===t)return;e.fixed=t;let i="scrollingElement"in document?document.scrollingElement:document.documentElement;if(!i)return;let s=t?i.scrollTop:parseInt(document.body.style.top??"0"),l=getComputedStyle(document.body),r=parseFloat(l.marginInlineStart)+parseFloat(l.marginInlineEnd),o={position:"fixed",top:`${-s}px`,left:"0",width:`calc(100vw - ${r}px)`,height:"100dvh","overflow-y":"scroll"};for(let[e,i]of Object.entries(o))document.body.style[e]=t?i:"";t||window.scrollTo(0,-s)}static getStylePropertyBool(t,e){let i=getComputedStyle(t).getPropertyValue(e).trim();if(!i.length)return null;if("string"!=typeof i)return!!i;try{return"true"==JSON.parse(i.toLowerCase())}catch(t){return 0!==i.length}}static getStylePropertyString(t,e){let i=getComputedStyle(t).getPropertyValue(e).trim().replace(RegExp('^"+|"+$',"g"),"");return i.length?"string"==typeof i?i:String(i):null}#t;#e;#i;#s;#l;#r=0;#o=[];#n=!1;constructor(t=null){let i=t?document.getElementById(t):document.getElementsByClassName(e.NS)[0];if(!i||(this.#t=i,this.#e=this.#t.getElementsByTagName("ul")[0],!this.#e))throw new DOMException;[this.#i,this.#l]=this.initFolder();let s=this.initBarItems();this.initPopup(s);let l=this.initOrder(s);this.#s=this.initFocusTrap();let r=Array.from(this.#e.querySelectorAll("li"));e.addHoverStateEventListener(this.#t,r),setTimeout(()=>{let t=new ResizeObserver(()=>requestAnimationFrame(()=>{if(this.#n){this.#n=!1;return}this.closeAll(s),this.alignItems(s,l)}));t.observe(this.#t),t.observe(this.#t.parentElement)},10),setTimeout(()=>this.#t.classList.add(e.CLS_READY),100)}initFolder(){let t=null,i=0;for(let s of Array.from(this.#e.children)){if(s.classList.contains(e.CLS_FOLDER)){t=s;break}i+=1}if(!t){(t=document.createElement("li")).classList.add(e.CLS_FOLDER);let s=e.getStylePropertyString(this.#t,e.CP_FOLDER_POS);null===s||"end"===s?(this.#e.append(t),i=this.#e.children.length-1):"start"===s&&(this.#e.prepend(t),i=0)}let s=t.querySelector(":scope > button");s||(s=document.createElement("button"),t.appendChild(s));let l=t.querySelector(":scope > button + ul, :scope > button + * > ul");return l||((l=document.createElement("ul")).classList.add("menu"),t.appendChild(l)),[l,i]}initBarItems(){let e=[],i=Array.from(this.#e.querySelectorAll(":scope > li"));for(let s of i){let i=s.querySelector(":scope > button"),l=i?.nextElementSibling,r=s.offsetWidth;e.push(new t(s,i,l,r))}return e}initPopup(t){for(let i of t){let{li:s,btn:l,popup:r}=i;if(l&&r){if(l.setAttribute("area-expanded","false"),!r.id){let t=l.id?l.id:s.id?s.id:"";t&&(r.id=t+"-sub")}r.id&&l.setAttribute("area-controls",r.id),l.addEventListener("click",r=>{l.classList.contains(e.CLS_OPENED)?this.close(i):(this.#e===s.parentElement&&this.closeAll(t,l),this.open(i)),r.stopPropagation()})}}window.addEventListener("keydown",t=>{if("Escape"===t.key&&this.#o.length){let{btn:t}=this.#o[this.#o.length-1];t&&(t.focus(),t.click())}}),!0===e.getStylePropertyBool(this.#t,e.CP_IS_CLOSED_AUTO)&&(document.addEventListener("DOMContentLoaded",()=>{window.addEventListener("scroll",e.throttle(()=>this.doOnScroll(t)),{passive:!0})}),document.addEventListener("click",()=>this.closeAll(t)))}initOrder(t){let i=Array(t.length);for(let e=0;e<t.length;e+=1){let{li:s}=t[e];i[e]=this.getWeightFromClass(s,t.length-e)}let s=Array(t.length);for(let e=0;e<t.length;e+=1)s[e]=e;return s.sort((t,e)=>i[t]<i[e]?1:i[t]>i[e]?-1:0),!0===e.getStylePropertyBool(this.#t,e.CP_IS_REVERSED)&&s.reverse(),s}getWeightFromClass(t,e){let i=t.className.split(" "),s=null;for(let t of i){let e=parseInt(t,10);!isNaN(e)&&(null===s||s<e)&&(s=e)}return s??e}initFocusTrap(){let t=document.createElement("li");return t.className="focus-trap",t.tabIndex=0,t.addEventListener("focus",()=>{if(this.#o.length){let{btn:t}=this.#o[0];t&&t.focus()}}),t}open(t){let{li:i,btn:s,popup:l}=t;if(s&&l){if(i.classList.add(e.CLS_OPENED),s.classList.add(e.CLS_OPENED),s.setAttribute("area-expanded","true"),l.classList.add(e.CLS_ACTIVE),setTimeout(()=>l.classList.add(e.CLS_OPENED),0),this.#o.push(t),l.style.transform="",this.#o[0].popup&&this.adjustPopupInline(this.#o[0].popup),this.#r=window.scrollY,1===this.#o.length){let t="UL"===l.tagName?l:l.getElementsByClassName("UL")?.[0];t&&t.appendChild(this.#s)}!0===e.getStylePropertyBool(this.#t,e.CP_IS_BG_FIXED)&&(this.#n=!0,e.fixBackground(!0))}}adjustPopupInline(t){t.style.transform="",t.style.maxWidth="";let e=t.getBoundingClientRect(),i=this.#t.getBoundingClientRect();i.width<e.width&&(t.style.maxWidth=`${i.width}px`,e=t.getBoundingClientRect()),i.right<e.right&&(t.style.transform=`translateX(${i.right-e.right}px)`),e.left<i.left&&(t.style.transform=`translateX(${e.left-i.left}px)`)}close(t){let{li:i,btn:s,popup:l}=t;if(s&&l){if(i.classList.remove(e.CLS_OPENED),s.classList.remove(e.CLS_OPENED),s.setAttribute("area-expanded","false"),l.classList.remove(e.CLS_OPENED),setTimeout(()=>{if(l.classList.remove(e.CLS_ACTIVE),this.#o.length){let{popup:t}=this.#o[0];t&&this.adjustPopupInline(t)}},200),this.#o.pop(),0===this.#o.length){let t="UL"===l.tagName?l:l.getElementsByClassName("UL")?.[0];t&&this.#s.parentElement===t&&t.removeChild(this.#s)}e.getStylePropertyBool(this.#t,e.CP_IS_BG_FIXED)&&(this.#n=!0,e.fixBackground(!1))}}closeAll(t,i=null){if(this.#o.length){for(let e of t){let{btn:t}=e;t&&i!==t&&this.close(e)}this.#o.length=0,e.getStylePropertyBool(this.#t,e.CP_IS_BG_FIXED)&&(this.#n=!0,e.fixBackground(!1))}}doOnScroll(t){if(!this.#o.length||!this.#o[0].popup)return;let e=this.#o[0].popup.getBoundingClientRect();(e.bottom<0||0<e.top&&e.bottom<Math.abs(window.scrollY-this.#r))&&this.closeAll(t)}alignItems(t,i){this.setMaxWidth();let s=this.calcItemPlace(t,i);!1===e.getStylePropertyBool(this.#t,e.CP_IS_FOLDABLE)&&(s.fill(!0),s[this.#l]=!1),t[this.#l].li.style.display=s[this.#l]?"":"none";let l=this.#e.firstChild;for(let e=0;e<t.length;e+=1){let{li:i}=t[e];s[e]?(i.parentElement===this.#e&&(t[e].width=i.offsetWidth),this.#e.insertBefore(i,l.nextElementSibling),l=i):e!==this.#l&&this.#i.appendChild(i)}}setMaxWidth(){let t=this.#t.parentElement;if(t){let i=getComputedStyle(t),s=t.clientWidth-(parseFloat(i.paddingLeft)+parseFloat(i.paddingRight));this.#t.style.setProperty(e.CP_MAX_WIDTH,`${Math.floor(s)}px`)}}calcItemPlace(t,e){let i=Array(t.length),s=this.calcBarGap(),l=t.reduce((t,e)=>t+e.width,0)+s*(t.length-1)-(t[this.#l].width+s),r=this.calcBarWidth();if(r<l)for(let l of(r-=t[this.#l].width,i[this.#l]=!0,e))l!==this.#l&&(r-=t[l].width+s,i[l]=0<=r);else i.fill(!0),i[this.#l]=!1;return i}calcBarWidth(){this.#e.style.width="0";let t=Math.floor(this.#t.getBoundingClientRect().width);if(0===t&&this.#t.parentElement){let e=getComputedStyle(this.#t.parentElement);e.display.endsWith("flex")&&(this.#t.style.flexGrow="1",t=Math.floor(this.#t.getBoundingClientRect().width),this.#t.style.flexGrow="")}return this.#e.style.width="",t}calcBarGap(){let t=getComputedStyle(this.#e),e=parseInt(t.columnGap,10);return Number.isNaN(e)?0:e}}//# sourceMappingURL=index.382a8221.js.map

//# sourceMappingURL=index.382a8221.js.map
