window.menu_simplex=function(t=null){new MenuSimplex(t)};class MenuSimplex{static NS="menu-simplex";static CP_IS_FOLDABLE="--is-foldable";static CP_IS_CLOSED_AUTO="--is-closed-auto";static CP_IS_BG_FIXED="--is-background-fixed";static CP_IS_REVERSED="--is-reversed";static CP_FOLDER_POS="--folder-position";static CLS_FOLDER="folder";static CLS_CURRENT="current";static CLS_READY="ready";static CLS_HOVER="hover";static CLS_HOVER_ANCESTOR="hover-ancestor";static CLS_ACTIVE="active";static CLS_OPENED="opened";static CP_MAX_WIDTH="--max-width";static throttle(t){let e;function i(){e=!1,t()}return()=>{e||(e=!0,requestAnimationFrame(i))}}static addHoverStateEventListener(t,e){const i=e=>{const i=e.target.parentElement;if("mouse"===e.pointerType&&!i.classList.contains(MenuSimplex.CLS_CURRENT)){i.classList.add(MenuSimplex.CLS_HOVER);for(let e=i.parentElement;e&&e!==t;e=e.parentElement)"LI"===e.tagName&&e.classList.add(MenuSimplex.CLS_HOVER_ANCESTOR)}},s=e=>{const i=e.target.parentElement;if("mouse"===e.pointerType&&!i.classList.contains(MenuSimplex.CLS_CURRENT)){i.classList.remove(MenuSimplex.CLS_HOVER);for(let e=i.parentElement;e&&e!==t;e=e.parentElement)"LI"===e.tagName&&e.classList.remove(MenuSimplex.CLS_HOVER_ANCESTOR)}};for(const t of e)t.firstElementChild.addEventListener("pointerenter",i),t.firstElementChild.addEventListener("pointerleave",s)}static fixed;static fixBackground(t){if(MenuSimplex.fixed===t)return;MenuSimplex.fixed=t;const e=t?("scrollingElement"in document?document.scrollingElement:document.documentElement).scrollTop:parseInt(document.body.style.top??"0"),i=getComputedStyle(document.body),s={position:"fixed",top:-e+"px",left:"0",width:`calc(100vw - ${parseFloat(i.marginInlineStart)+parseFloat(i.marginInlineEnd)}px)`,height:"100dvh","overflow-y":"scroll"};for(const[e,i]of Object.entries(s))document.body.style[e]=t?i:null;t||window.scrollTo(0,-e)}static getStylePropertyBool(t,e){const i=getComputedStyle(t).getPropertyValue(e).trim();if(!i.length)return null;if("string"!=typeof i)return Boolean(i);try{return"true"==JSON.parse(i.toLowerCase())}catch(t){return 0!==i.length}}static getStylePropertyString(t,e){const i=getComputedStyle(t).getPropertyValue(e).trim().replace(new RegExp('^"+|"+$',"g"),"");return i.length?"string"==typeof i?i:String(i):null}#t;#e;#i;#s;#l;#n=0;#o=[];#r=!1;constructor(t=null){if(this.#t=t?document.getElementById(t):document.getElementsByClassName(MenuSimplex.NS)[0],!this.#t)return;if(this.#e=this.#t.getElementsByTagName("ul")[0],!this.#e)return;[this.#i,this.#l]=this.initFolder();const e=this.initBarItems();this.initPopup(e);const i=this.initOrder(e);this.#s=this.initFocusTrap();const s=Array.from(this.#e.querySelectorAll("li"));MenuSimplex.addHoverStateEventListener(this.#t,s),setTimeout((()=>{const t=new ResizeObserver((()=>requestAnimationFrame((()=>{this.#r?this.#r=!1:(this.closeAll(e),this.alignItems(e,i))}))));t.observe(this.#t),t.observe(this.#t.parentElement)}),10),setTimeout((()=>this.#t.classList.add(MenuSimplex.CLS_READY)),100)}initFolder(){let t=null,e=0;for(const i of this.#e.children){if(i.classList.contains(MenuSimplex.CLS_FOLDER)){t=i;break}e+=1}if(!t){t=document.createElement("li"),t.classList.add(MenuSimplex.CLS_FOLDER);const i=MenuSimplex.getStylePropertyString(this.#t,MenuSimplex.CP_FOLDER_POS);null===i||"end"===i?(this.#e.append(t),e=this.#e.children.length-1):"start"===i&&(this.#e.prepend(t),e=0)}let i=t.querySelector(":scope > button");i||(i=document.createElement("button"),t.appendChild(i));let s=t.querySelector(":scope > button + ul, :scope > button + * > ul");return s||(s=document.createElement("ul"),s.classList.add("menu"),t.appendChild(s)),[s,e]}initBarItems(){const t=[],e=Array.from(this.#e.querySelectorAll(":scope > li"));for(const i of e){const e=i.querySelector(":scope > button"),s=e?.nextElementSibling,l=i.offsetWidth;t.push({li:i,btn:e,popup:s,width:l})}return t}initPopup(t){for(const e of t){const{li:i,btn:s,popup:l}=e;if(s&&l){if(s.setAttribute("area-expanded","false"),!l.id){const t=s.id?s.id:i.id?i.id:"";t&&(l.id=t+"-sub")}l.id&&s.setAttribute("area-controls",l.id),s.addEventListener("click",(l=>{s.classList.contains(MenuSimplex.CLS_OPENED)?this.close(e):(this.#e===i.parentElement&&this.closeAll(t,s),this.open(e)),l.stopPropagation()}))}}window.addEventListener("keydown",(t=>{if("Escape"===t.key&&this.#o.length){const t=this.#o[this.#o.length-1].btn;t.focus(),t.click()}})),!0===MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_CLOSED_AUTO)&&(document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("scroll",MenuSimplex.throttle((()=>this.doOnScroll(t))),{passive:!0})})),document.addEventListener("click",(()=>this.closeAll(t))))}initOrder(t){const e=new Array(t.length);for(let i=0;i<t.length;i+=1){const{li:s}=t[i];e[i]=this.getWeightFromClass(s,t.length-i)}const i=new Array(t.length);for(let e=0;e<t.length;e+=1)i[e]=e;return i.sort(((t,i)=>e[t]<e[i]?1:e[t]>e[i]?-1:0)),!0===MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_REVERSED)&&i.reverse(),i}getWeightFromClass(t,e){const i=t.className.split(" ");let s=null;for(const t of i){const e=parseInt(t,10);isNaN(e)||(null===s||s<e)&&(s=e)}return s??e}initFocusTrap(){const t=document.createElement("li");return t.className="focus-trap",t.tabIndex=0,t.addEventListener("focus",(()=>{this.#o.length&&this.#o[0].btn.focus()})),t}open(t){const{li:e,btn:i,popup:s}=t;if(s){if(e.classList.add(MenuSimplex.CLS_OPENED),i.classList.add(MenuSimplex.CLS_OPENED),i.setAttribute("area-expanded","true"),s.classList.add(MenuSimplex.CLS_ACTIVE),setTimeout((()=>s.classList.add(MenuSimplex.CLS_OPENED)),0),this.#o.push(t),s.style.transform=null,this.adjustPopupInline(this.#o[0].popup),this.#n=window.scrollY,1===this.#o.length){const t="UL"===s.tagName?s:s.getElementsByClassName("UL")?.[0];t&&t.appendChild(this.#s)}!0===MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)&&(this.#r=!0,MenuSimplex.fixBackground(!0))}}adjustPopupInline(t){t.style.transform=null,t.style.maxWidth=null;let e=t.getBoundingClientRect();const i=this.#t.getBoundingClientRect();i.width<e.width&&(t.style.maxWidth=`${i.width}px`,e=t.getBoundingClientRect()),i.right<e.right&&(t.style.transform=`translateX(${i.right-e.right}px)`),e.left<i.left&&(t.style.transform=`translateX(${e.left-i.left}px)`)}close(t){const{li:e,btn:i,popup:s}=t;if(s){if(e.classList.remove(MenuSimplex.CLS_OPENED),i.classList.remove(MenuSimplex.CLS_OPENED),i.setAttribute("area-expanded","false"),s.classList.remove(MenuSimplex.CLS_OPENED),setTimeout((()=>{s.classList.remove(MenuSimplex.CLS_ACTIVE),this.#o.length&&this.adjustPopupInline(this.#o[0].popup)}),200),this.#o.pop(),0===this.#o.length){const t="UL"===s.tagName?s:s.getElementsByClassName("UL")?.[0];t&&this.#s.parentElement===t&&t.removeChild(this.#s)}MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)&&(this.#r=!0,MenuSimplex.fixBackground(!1))}}closeAll(t,e=null){if(this.#o.length){for(const i of t){const{btn:t}=i;t&&e!==t&&this.close(i)}this.#o.length=0,MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_BG_FIXED)&&(this.#r=!0,MenuSimplex.fixBackground(!1))}}doOnScroll(t){if(!this.#o.length||!this.#o[0].popup)return;const e=this.#o[0].popup.getBoundingClientRect();(e.bottom<0||0<e.top&&e.bottom<Math.abs(window.scrollY-this.#n))&&this.closeAll(t)}alignItems(t,e){this.setMaxWidth();const i=this.calcItemPlace(t,e);!1===MenuSimplex.getStylePropertyBool(this.#t,MenuSimplex.CP_IS_FOLDABLE)&&(i.fill(!0),i[this.#l]=!1),t[this.#l].li.style.display=i[this.#l]?null:"none";let s=this.#e.firstChild;for(let e=0;e<t.length;e+=1){const{li:l}=t[e];i[e]?(l.parentElement===this.#e&&(t[e].width=l.offsetWidth),this.#e.insertBefore(l,s.nextElementSibling),s=l):e!==this.#l&&this.#i.appendChild(l)}}setMaxWidth(){const t=this.#t.parentElement,e=getComputedStyle(t),i=t.clientWidth-(parseFloat(e.paddingLeft)+parseFloat(e.paddingRight));this.#t.style.setProperty(MenuSimplex.CP_MAX_WIDTH,`${Math.floor(i)}px`)}calcItemPlace(t,e){const i=new Array(t.length),s=this.calcBarGap(),l=t.reduce(((t,e)=>t+e.width),0)+s*(t.length-1)-(t[this.#l].width+s);let n=this.calcBarWidth();if(n<l){n-=t[this.#l].width,i[this.#l]=!0;for(const l of e)l!==this.#l&&(n-=t[l].width+s,i[l]=0<=n)}else i.fill(!0),i[this.#l]=!1;return i}calcBarWidth(){this.#e.style.width="0";let t=Math.floor(this.#t.getBoundingClientRect().width);if(0===t){getComputedStyle(this.#t.parentElement).display.endsWith("flex")&&(this.#t.style.flexGrow=1,t=Math.floor(this.#t.getBoundingClientRect().width),this.#t.style.flexGrow=null)}return this.#e.style.width=null,t}calcBarGap(){const t=getComputedStyle(this.#e),e=parseInt(t.columnGap,10);return Number.isNaN(e)?0:e}}
//# sourceMappingURL=simplex.min.js.map