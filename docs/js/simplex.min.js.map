{"version":3,"sources":["simplex.js"],"names":["window","id","MenuSimplex","static","throttle","fn","isRunning","run","requestAnimationFrame","addHoverStateEventListener","root","items","enter","e","li","target","parentElement","pointerType","classList","contains","CLS_CURRENT","add","CLS_HOVER","elm","tagName","CLS_HOVER_ANCESTOR","leave","remove","it","firstElementChild","addEventListener","fixBackground","enabled","fixed","sy","document","scrollingElement","documentElement","scrollTop","parseInt","body","style","top","cs","getComputedStyle","ss","position","left","width","parseFloat","marginInlineStart","marginInlineEnd","height","key","value","Object","entries","scrollTo","getStylePropertyBool","prop","v","getPropertyValue","trim","length","Boolean","JSON","parse","toLowerCase","getStylePropertyString","replace","RegExp","String","divRoot","ulBar","ulFld","liFocusTrap","fldIdx","scrollY","curIts","skipResize","constructor","this","getElementById","getElementsByClassName","NS","getElementsByTagName","initFolder","its","initBarItems","initPopup","order","initOrder","initFocusTrap","allLis","Array","from","querySelectorAll","setTimeout","ro","ResizeObserver","closeAll","alignItems","observe","CLS_READY","idx","children","CLS_FOLDER","createElement","pos","CP_FOLDER_POS","append","prepend","btn","querySelector","appendChild","ul","lis","popup","nextElementSibling","offsetWidth","push","setAttribute","CLS_OPENED","close","open","stopPropagation","focus","click","CP_IS_CLOSED_AUTO","doOnScroll","passive","ws","i","getWeightFromClass","sort","a","b","CP_IS_REVERSED","reverse","def","className","split","w","c","n","isNaN","tabIndex","CLS_ACTIVE","transform","adjustPopupInline","CP_IS_BG_FIXED","maxWidth","pr","getBoundingClientRect","rr","right","pop","removeChild","opening","bcr","bottom","Math","abs","setMaxWidth","inBar","calcItemPlace","CP_IS_FOLDABLE","fill","display","prevElm","firstChild","insertBefore","p","s","clientWidth","paddingLeft","paddingRight","setProperty","CP_MAX_WIDTH","floor","gap","calcBarGap","sumW","reduce","barW","calcBarWidth","endsWith","flexGrow","g","columnGap","Number"],"mappings":"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","file":"simplex.min.js","sourcesContent":["/**\n * Menu Simplex (Progressively collapsing menu)\n *\n * @author Takuto Yanagida\n * @version 2023-09-23\n */\n\nwindow['menu_simplex'] = function (id = null) {\n\tnew MenuSimplex(id);\n};\n\nclass MenuSimplex {\n\n\tstatic NS = 'menu-simplex';\n\n\tstatic CP_IS_FOLDABLE    = '--is-foldable';\n\tstatic CP_IS_CLOSED_AUTO = '--is-closed-auto';\n\tstatic CP_IS_BG_FIXED    = '--is-background-fixed';\n\tstatic CP_IS_REVERSED    = '--is-reversed';\n\tstatic CP_FOLDER_POS     = '--folder-position';\n\n\tstatic CLS_FOLDER  = 'folder';\n\tstatic CLS_CURRENT = 'current';\n\n\tstatic CLS_READY          = 'ready';\n\tstatic CLS_HOVER          = 'hover';\n\tstatic CLS_HOVER_ANCESTOR = 'hover-ancestor';\n\tstatic CLS_ACTIVE         = 'active';\n\tstatic CLS_OPENED         = 'opened';\n\n\tstatic CP_MAX_WIDTH = '--max-width';\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tstatic throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\n\tstatic addHoverStateEventListener(root, items) {\n\t\tconst enter = e => {\n\t\t\tconst li = e.target.parentElement;\n\n\t\t\tif (e.pointerType === 'mouse' && !li.classList.contains(MenuSimplex.CLS_CURRENT)) {\n\t\t\t\tli.classList.add(MenuSimplex.CLS_HOVER);\n\t\t\t\tfor (let elm = li.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\tif (elm.tagName === 'LI') {\n\t\t\t\t\t\telm.classList.add(MenuSimplex.CLS_HOVER_ANCESTOR);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst leave = e => {\n\t\t\tconst li = e.target.parentElement;\n\n\t\t\tif (e.pointerType === 'mouse' && !li.classList.contains(MenuSimplex.CLS_CURRENT)) {\n\t\t\t\tli.classList.remove(MenuSimplex.CLS_HOVER);\n\t\t\t\tfor (let elm = li.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\tif (elm.tagName === 'LI') {\n\t\t\t\t\t\telm.classList.remove(MenuSimplex.CLS_HOVER_ANCESTOR);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const it of items) {\n\t\t\tit.firstElementChild.addEventListener('pointerenter', enter);\n\t\t\tit.firstElementChild.addEventListener('pointerleave', leave);\n\t\t}\n\t}\n\n\tstatic fixed;\n\n\tstatic fixBackground(enabled) {\n\t\tif (MenuSimplex.fixed === enabled) return;\n\t\tMenuSimplex.fixed = enabled;\n\n\t\tconst scrollingElement = () => {\n\t\t\treturn ('scrollingElement' in document) ? document.scrollingElement : document.documentElement;\n\t\t};\n\t\tconst sy = enabled ? scrollingElement().scrollTop : parseInt(document.body.style.top ?? '0');\n\t\tconst cs = getComputedStyle(document.body);\n\t\tconst mw = parseFloat(cs.marginInlineStart) + parseFloat(cs.marginInlineEnd);\n\t\tconst ss = {\n\t\t\tposition: 'fixed',\n\t\t\ttop     : `${-sy}px`,\n\t\t\tleft    : '0',\n\t\t\twidth   : `calc(100vw - ${mw}px)`,\n\t\t\theight  : '100dvh',\n\n\t\t\t'overflow-y': 'scroll',  // For keeping scroll bar width.\n\t\t};\n\t\tfor (const [key, value] of Object.entries(ss)) {\n\t\t\tdocument.body.style[key] = enabled ? value : null;\n\t\t}\n\t\tif (!enabled) {\n\t\t\twindow.scrollTo(0, -sy);\n\t\t}\n\t}\n\n\tstatic getStylePropertyBool(elm, prop) {\n\t\tconst v = getComputedStyle(elm).getPropertyValue(prop).trim();\n\t\tif (!v.length) return null;\n\t\tif (typeof v !== 'string') return Boolean(v);\n\t\ttry {\n\t\t\treturn 'true' == JSON.parse(v.toLowerCase());\n\t\t} catch(e) {\n\t\t\treturn v.length !== 0;\n\t\t}\n\t}\n\n\tstatic getStylePropertyString(elm, prop) {\n\t\tconst v = getComputedStyle(elm).getPropertyValue(prop).trim().replace(new RegExp('^\\\"+|\\\"+$', 'g'), '');\n\t\tif (!v.length) return null;\n\t\treturn (typeof v === 'string') ? v : String(v);\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t#divRoot;\n\t#ulBar;\n\t#ulFld;\n\t#liFocusTrap;\n\n\t#fldIdx;\n\n\t#scrollY = 0;\n\t#curIts  = [];\n\n\t#skipResize = false;\n\n\tconstructor(id = null) {\n\t\tthis.#divRoot = id ? document.getElementById(id) : document.getElementsByClassName(MenuSimplex.NS)[0];\n\t\tif (!this.#divRoot) return;\n\t\tthis.#ulBar = this.#divRoot.getElementsByTagName('ul')[0];\n\t\tif (!this.#ulBar) return;\n\n\t\t[this.#ulFld, this.#fldIdx] = this.initFolder();\n\t\tconst its = this.initBarItems();\n\t\tthis.initPopup(its);\n\t\tconst order = this.initOrder(its);\n\t\tthis.#liFocusTrap = this.initFocusTrap();\n\n\t\tconst allLis = Array.from(this.#ulBar.querySelectorAll('li'));\n\t\tMenuSimplex.addHoverStateEventListener(this.#divRoot, allLis);\n\n\t\tsetTimeout(() => {\n\t\t\tconst ro = new ResizeObserver(\n\t\t\t\t() => requestAnimationFrame(() => {\n\t\t\t\t\tif (this.#skipResize) {\n\t\t\t\t\t\tthis.#skipResize = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.closeAll(its);\n\t\t\t\t\tthis.alignItems(its, order);\n\t\t\t\t})\n\t\t\t);\n\t\t\tro.observe(this.#divRoot);\n\t\t\tro.observe(this.#divRoot.parentElement);\n\t\t}, 10);\n\t\tsetTimeout(() => this.#divRoot.classList.add(MenuSimplex.CLS_READY), 100);\n\t}\n\n\tinitFolder() {\n\t\tlet li  = null;\n\t\tlet idx = 0;\n\t\tfor (const e of this.#ulBar.children) {\n\t\t\tif (e.classList.contains(MenuSimplex.CLS_FOLDER)) {\n\t\t\t\tli = e;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tidx += 1;\n\t\t}\n\t\tif (!li) {\n\t\t\tli = document.createElement('li');\n\t\t\tli.classList.add(MenuSimplex.CLS_FOLDER);\n\n\t\t\tconst pos = MenuSimplex.getStylePropertyString(this.#divRoot, MenuSimplex.CP_FOLDER_POS);\n\t\t\tif (null === pos || 'end' === pos) {\n\t\t\t\tthis.#ulBar.append(li);\n\t\t\t\tidx = this.#ulBar.children.length - 1;\n\t\t\t} else if ('start' === pos) {\n\t\t\t\tthis.#ulBar.prepend(li);\n\t\t\t\tidx = 0;\n\t\t\t}\n\t\t}\n\t\tlet btn = li.querySelector(':scope > button');\n\t\tif (!btn) {\n\t\t\tbtn = document.createElement('button');\n\t\t\tli.appendChild(btn);\n\t\t}\n\t\tlet ul = li.querySelector(':scope > button + ul, :scope > button + * > ul');\n\t\tif (!ul) {\n\t\t\tul = document.createElement('ul');\n\t\t\tul.classList.add('menu');\n\t\t\tli.appendChild(ul);\n\t\t}\n\t\treturn [ul, idx];\n\t}\n\n\tinitBarItems() {\n\t\tconst its = [];\n\t\tconst lis = Array.from(this.#ulBar.querySelectorAll(':scope > li'));\n\t\tfor (const li of lis) {\n\t\t\tconst btn   = li.querySelector(':scope > button');\n\t\t\tconst popup = btn?.nextElementSibling;\n\t\t\tconst width = li.offsetWidth;\n\t\t\tits.push({ li, btn, popup, width });\n\t\t}\n\t\treturn its;\n\t}\n\n\tinitPopup(its) {\n\t\tfor (const it of its) {\n\t\t\tconst { li, btn, popup } = it;\n\t\t\tif (!btn || !popup) continue;\n\n\t\t\tbtn.setAttribute('area-expanded', 'false');\n\t\t\tif (!popup.id) {\n\t\t\t\tconst id = btn.id ? btn.id : (li.id ? li.id : '');\n\t\t\t\tif (id) {\n\t\t\t\t\tpopup.id = id + '-sub';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (popup.id) {\n\t\t\t\tbtn.setAttribute('area-controls', popup.id);\n\t\t\t}\n\t\t\tbtn.addEventListener('click', e => {\n\t\t\t\tif (btn.classList.contains(MenuSimplex.CLS_OPENED)) {\n\t\t\t\t\tthis.close(it);\n\t\t\t\t} else {\n\t\t\t\t\tif (this.#ulBar === li.parentElement) {\n\t\t\t\t\t\tthis.closeAll(its, btn);\n\t\t\t\t\t}\n\t\t\t\t\tthis.open(it);\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t}\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tif (this.#curIts.length) {\n\t\t\t\t\tconst btn = this.#curIts[this.#curIts.length - 1].btn;\n\t\t\t\t\tbtn.focus();\n\t\t\t\t\tbtn.click();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (true === MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_CLOSED_AUTO)) {\n\t\t\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\t\t\twindow.addEventListener('scroll', MenuSimplex.throttle(() => this.doOnScroll(its)), { passive: true });\n\t\t\t});\n\t\t\tdocument.addEventListener('click', () => this.closeAll(its));\n\t\t}\n\t}\n\n\tinitOrder(its) {\n\t\tconst ws = new Array(its.length);\n\t\tfor (let i = 0; i < its.length; i += 1) {\n\t\t\tconst { li } = its[i];\n\t\t\tws[i] = this.getWeightFromClass(li, its.length - i);\n\t\t}\n\t\tconst order = new Array(its.length);\n\t\tfor (let i = 0; i < its.length; i += 1) order[i] = i;\n\t\torder.sort((a, b) => ws[a] < ws[b] ? 1 : ws[a] > ws[b] ? -1 : 0);\n\n\t\tif (true === MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_REVERSED)) {\n\t\t\torder.reverse();\n\t\t}\n\t\treturn order;\n\t}\n\n\tgetWeightFromClass(li, def) {\n\t\tconst cs = li.className.split(' ');\n\t\tlet w = null;\n\t\tfor (const c of cs) {\n\t\t\tconst n = parseInt(c, 10);\n\t\t\tif (isNaN(n)) continue;\n\t\t\tif (null === w || w < n) w = n;\n\t\t}\n\t\treturn w ?? def;\n\t}\n\n\tinitFocusTrap() {\n\t\tconst e = document.createElement('li');\n\t\te.className = 'focus-trap';\n\t\te.tabIndex = 0;\n\t\te.addEventListener('focus', () => {\n\t\t\tif (this.#curIts.length) {\n\t\t\t\tthis.#curIts[0].btn.focus();\n\t\t\t}\n\t\t});\n\t\treturn e;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\topen(it) {\n\t\tconst { li, btn, popup } = it;\n\t\tif (!popup) return;\n\n\t\tli.classList.add(MenuSimplex.CLS_OPENED);\n\t\tbtn.classList.add(MenuSimplex.CLS_OPENED);\n\t\tbtn.setAttribute('area-expanded', 'true');\n\t\tpopup.classList.add(MenuSimplex.CLS_ACTIVE);\n\n\t\tsetTimeout(() => popup.classList.add(MenuSimplex.CLS_OPENED), 0);\n\t\tthis.#curIts.push(it);\n\n\t\tpopup.style.transform = null;\n\t\tthis.adjustPopupInline(this.#curIts[0].popup);\n\n\t\tthis.#scrollY = window.scrollY;\n\n\t\tif (1 === this.#curIts.length) {\n\t\t\tconst ul = ('UL' === popup.tagName) ? popup : popup.getElementsByClassName('UL')?.[0];\n\t\t\tif (ul) {\n\t\t\t\tul.appendChild(this.#liFocusTrap);\n\t\t\t}\n\t\t}\n\n\t\tif (true === MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_BG_FIXED)) {\n\t\t\tthis.#skipResize = true;\n\t\t\tMenuSimplex.fixBackground(true);\n\t\t}\n\t}\n\n\tadjustPopupInline(popup) {\n\t\tpopup.style.transform = null;\n\t\tpopup.style.maxWidth = null;\n\t\tlet pr = popup.getBoundingClientRect();\n\t\tconst rr = this.#divRoot.getBoundingClientRect();\n\t\tif (rr.width < pr.width) {\n\t\t\tpopup.style.maxWidth = `${rr.width}px`;\n\t\t\tpr = popup.getBoundingClientRect();\n\t\t}\n\t\tif (rr.right < pr.right) {\n\t\t\tpopup.style.transform = `translateX(${rr.right - pr.right}px)`;\n\t\t}\n\t\tif (pr.left < rr.left) {\n\t\t\tpopup.style.transform = `translateX(${pr.left - rr.left}px)`;\n\t\t}\n\t}\n\n\tclose(it) {\n\t\tconst { li, btn, popup } = it;\n\t\tif (!popup) return;\n\n\t\tli.classList.remove(MenuSimplex.CLS_OPENED);\n\t\tbtn.classList.remove(MenuSimplex.CLS_OPENED);\n\t\tbtn.setAttribute('area-expanded', 'false');\n\t\tpopup.classList.remove(MenuSimplex.CLS_OPENED);\n\n\t\tsetTimeout(() => {\n\t\t\tpopup.classList.remove(MenuSimplex.CLS_ACTIVE);\n\t\t\tif (this.#curIts.length) this.adjustPopupInline(this.#curIts[0].popup);\n\t\t}, 200);\n\t\tthis.#curIts.pop();\n\n\t\tif (0 === this.#curIts.length) {\n\t\t\tconst ul = ('UL' === popup.tagName) ? popup : popup.getElementsByClassName('UL')?.[0];\n\t\t\tif (ul && this.#liFocusTrap.parentElement === ul) {\n\t\t\t\tul.removeChild(this.#liFocusTrap);\n\t\t\t}\n\t\t}\n\n\t\tif (MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_BG_FIXED)) {\n\t\t\tthis.#skipResize = true;\n\t\t\tMenuSimplex.fixBackground(false);\n\t\t}\n\t}\n\n\tcloseAll(its, opening = null) {\n\t\tif (!this.#curIts.length) return;\n\n\t\tfor (const it of its) {\n\t\t\tconst { btn } = it;\n\t\t\tif (btn && opening !== btn) {\n\t\t\t\tthis.close(it);\n\t\t\t}\n\t\t}\n\t\tthis.#curIts.length = 0;\n\n\t\tif (MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_BG_FIXED)) {\n\t\t\tthis.#skipResize = true;\n\t\t\tMenuSimplex.fixBackground(false);\n\t\t}\n\t}\n\n\tdoOnScroll(its) {\n\t\tif (!this.#curIts.length || !this.#curIts[0].popup) {\n\t\t\treturn;\n\t\t}\n\t\tconst bcr = this.#curIts[0].popup.getBoundingClientRect();\n\t\tif (\n\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.scrollY - this.#scrollY))  // When fixed\n\t\t) {\n\t\t\tthis.closeAll(its);\n\t\t}\n\t}\n\n\talignItems(its, order) {\n\t\tthis.setMaxWidth();\n\t\tconst inBar = this.calcItemPlace(its, order);\n\n\t\tif (false === MenuSimplex.getStylePropertyBool(this.#divRoot, MenuSimplex.CP_IS_FOLDABLE)) {\n\t\t\tinBar.fill(true);\n\t\t\tinBar[this.#fldIdx] = false;\n\t\t}\n\t\tits[this.#fldIdx].li.style.display = inBar[this.#fldIdx] ? null : 'none';\n\n\t\tlet prevElm = this.#ulBar.firstChild;\n\t\tfor (let i = 0; i < its.length; i += 1) {\n\t\t\tconst { li } = its[i];\n\t\t\tif (inBar[i]) {\n\t\t\t\tif (li.parentElement === this.#ulBar) {\n\t\t\t\t\tits[i].width = li.offsetWidth;\n\t\t\t\t}\n\t\t\t\tthis.#ulBar.insertBefore(li, prevElm.nextElementSibling);\n\t\t\t\tprevElm = li;\n\t\t\t} else if(i !== this.#fldIdx) {\n\t\t\t\tthis.#ulFld.appendChild(li);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetMaxWidth() {\n\t\tconst p = this.#divRoot.parentElement;\n\t\tconst s = getComputedStyle(p);\n\t\tconst w = p.clientWidth - (parseFloat(s.paddingLeft) + parseFloat(s.paddingRight));\n\t\tthis.#divRoot.style.setProperty(MenuSimplex.CP_MAX_WIDTH, `${Math.floor(w)}px`);\n\t}\n\n\tcalcItemPlace(its, order) {\n\t\tconst inBar = new Array(its.length);\n\n\t\tconst gap  = this.calcBarGap();\n\t\tconst sumW = its.reduce((s, v) => s + v.width, 0) + (gap * (its.length - 1)) - (its[this.#fldIdx].width + gap);\n\t\tlet barW   = this.calcBarWidth();\n\n\t\tif (barW < sumW) {\n\t\t\tbarW -= its[this.#fldIdx].width;\n\t\t\tinBar[this.#fldIdx] = true;\n\n\t\t\tfor (const idx of order) {\n\t\t\t\tif (idx !== this.#fldIdx) {\n\t\t\t\t\tbarW -= its[idx].width + gap;\n\t\t\t\t\tinBar[idx] = (0 <= barW);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tinBar.fill(true);\n\t\t\tinBar[this.#fldIdx] = false;\n\t\t}\n\t\treturn inBar;\n\t}\n\n\tcalcBarWidth() {\n\t\tthis.#ulBar.style.width = '0';\n\t\tlet w = Math.floor(this.#divRoot.getBoundingClientRect().width);\n\n\t\tif (0 === w) {\n\t\t\tconst s = getComputedStyle(this.#divRoot.parentElement);\n\t\t\tif (s.display.endsWith('flex')) {\n\t\t\t\tthis.#divRoot.style.flexGrow = 1;\n\t\t\t\tw = Math.floor(this.#divRoot.getBoundingClientRect().width);\n\t\t\t\tthis.#divRoot.style.flexGrow = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.#ulBar.style.width = null;\n\t\treturn w;\n\t}\n\n\tcalcBarGap() {\n\t\tconst s = getComputedStyle(this.#ulBar);\n\t\tconst g = parseInt(s.columnGap, 10);\n\t\treturn Number.isNaN(g) ? 0 : g;\n\t}\n\n}\n"]}