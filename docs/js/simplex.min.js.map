{"version":3,"sources":["simplex.js"],"names":["window","id","opts","CLS_ACTIVE","CLS_OPENED","CP_MAX_WIDTH","CP_FOLDABLE","root","document","getElementById","getElementsByClassName","ulBar","querySelector","getElementsByTagName","autoClose","reversed","btnPos","scrollY","curBtns","scrollListeners","onScroll","fn","doFirst","push","isRunning","run","requestAnimationFrame","throttle","addEventListener","l","passive","fixed","fixBackground","enabled","sy","scrollingElement","documentElement","scrollTop","parseInt","body","style","top","cs","getComputedStyle","ss","position","left","width","parseFloat","marginInlineStart","marginInlineEnd","height","key","value","Object","entries","scrollTo","ulFolder","li","createElement","classList","add","append","prepend","btn","appendChild","ul","initFolder","lis","Array","from","querySelectorAll","fIdx","findIndex","e","contains","buttons","bs","popup","nextElementSibling","setAttribute","close","parentElement","closeAll","open","stopPropagation","length","click","bcr","getBoundingClientRect","bottom","Math","abs","doOnScroll","initPopup","order","ws","i","getWeightFromClass","sort","a","b","reverse","initOrder","items","clsCurrent","clsHover","clsHoverAncestor","enter","pointerType","target","elm","leave","remove","it","addHoverStateEventListener","stopResize","def","className","split","w","c","n","isNaN","console","log","setTimeout","pop","opening","map","offsetWidth","rob","ResizeObserver","pref","getPropertyValue","p","clientWidth","paddingLeft","paddingRight","setProperty","floor","setMaxWidth","barW","colGap","columnGap","Number","inBar","ulBarW","sumW","reduce","s","v","idx","fill","calcItemPlace","trim","display","prevElm","firstChild","insertBefore","alignItems","observe"],"mappings":"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","file":"simplex.min.js","sourcesContent":["/**\n * Menu Simplex (Progressively collapsing menu)\n *\n * @author Takuto Yanagida\n * @version 2023-09-19\n */\n\nwindow['menu_simplex'] = window['menu_simplex'] ?? {};\n\nwindow['menu_simplex'] = function (id = null, opts = {}) {\n\tconst NS = 'menu-simplex';\n\n\tconst CLS_CURRENT = 'current';\n\n\tconst CLS_READY  = 'ready';\n\tconst CLS_HOVER  = 'hover';\n\tconst CLS_ACTIVE = 'active';\n\tconst CLS_OPENED = 'opened';\n\n\tconst CP_MAX_WIDTH = '--max-width';\n\tconst CP_FOLDABLE  = '--foldable';\n\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\n\tif (!root) return;\n\tconst ulBar = root.querySelector('.menu') ?? root.getElementsByTagName('ul')[0];\n\tif (!ulBar) return;\n\n\tconst autoClose = opts['autoClose']      ?? true;\n\tconst reversed  = opts['reversed']       ?? false;\n\tconst btnPos    = opts['buttonPosition'] ?? 'end';  // 'start' or 'end';\n\n\tlet scrollY = 0;\n\tlet curBtns = [];\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2023-09-16\n\t */\n\t\n\tconst scrollListeners = [];\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction addHoverStateEventListener(items, clsCurrent, clsHover, root = null, clsHoverAncestor = null) {\n\t\tconst enter = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.add(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.add(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst leave = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.remove(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.remove(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const it of items) {\n\t\t\tit.addEventListener('pointerenter', enter);\n\t\t\tit.addEventListener('pointerleave', leave);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tlet fixed = false;\n\t\n\tfunction fixBackground(enabled) {\n\t\tif (fixed === enabled) return;\n\t\tfixed = enabled;\n\t\n\t\tconst scrollingElement = () => {\n\t\t\treturn ('scrollingElement' in document) ? document.scrollingElement : document.documentElement;\n\t\t};\n\t\tconst sy = enabled ? scrollingElement().scrollTop : parseInt(document.body.style.top ?? '0');\n\t\tconst cs = getComputedStyle(document.body);\n\t\tconst mw = parseFloat(cs.marginInlineStart) + parseFloat(cs.marginInlineEnd);\n\t\tconst ss = {\n\t\t\tposition: 'fixed',\n\t\t\ttop     : `${-sy}px`,\n\t\t\tleft    : '0',\n\t\t\twidth   : `calc(100vw - ${mw}px)`,\n\t\t\theight  : '100dvh',\n\t\n\t\t\t'overflow-y': 'scroll',  // For keeping scroll bar width.\n\t\t};\n\t\tfor (const [key, value] of Object.entries(ss)) {\n\t\t\tdocument.body.style[key] = enabled ? value : null;\n\t\t}\n\t\tif (!enabled) {\n\t\t\twindow.scrollTo(0, -sy);\n\t\t}\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tconst ulFolder = initFolder(ulBar, btnPos);\n\tconst lis      = Array.from(ulBar.querySelectorAll(':scope > li'));\n\tconst fIdx     = lis.findIndex(e => e.classList.contains('hamburger'));\n\tconst buttons  = initPopup(ulBar, lis, autoClose);\n\tconst order    = initOrder(lis, reversed);\n\n\tfor (const li of lis) {\n\t\tli.addEventListener('click', () => closeAll(buttons));\n\t}\n\taddHoverStateEventListener(lis, CLS_CURRENT, CLS_HOVER);\n\n\tlet stopResize = false;\n\n\tlet ws = [];\n\tsetTimeout(() => {\n\t\tws = lis.map(e => e.offsetWidth);\n\t\tconst rob = new ResizeObserver(() => {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconsole.log('> resize');\n\t\t\t\tif (stopResize) {\n\t\t\t\t\tstopResize = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst d = setMaxWidth(root);\n\t\t\t\t// if (!curBtns.length || -1 === d) {  // For when window width changes by background fixing.\n\t\t\t\tif (!stopResize) {  // For when window width changes by background fixing.\n\t\t\t\t\tcloseAll(buttons);\n\t\t\t\t\talignItems(ws, ulBar, ulFolder, lis, fIdx, order);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\trob.observe(root);\n\t\trob.observe(root.parentElement);\n\t}, 10);\n\tsetTimeout(() => root.classList.add(CLS_READY), 100);\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initOrder(lis, reversed) {\n\t\tconst ws = new Array(lis.length);\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tws[i] = getWeightFromClass(lis[i], lis.length - i);\n\t\t}\n\t\tconst order = new Array(lis.length);\n\t\tfor (let i = 0; i < lis.length; i += 1) order[i] = i;\n\t\torder.sort((a, b) => ws[a] < ws[b] ? 1 : ws[a] > ws[b] ? -1 : 0);\n\n\t\tif (reversed) {\n\t\t\torder.reverse();\n\t\t}\n\t\treturn order;\n\t}\n\n\tfunction getWeightFromClass(li, def) {\n\t\tconst cs = li.className.split(' ');\n\t\tlet w = null;\n\t\tfor (const c of cs) {\n\t\t\tconst n = parseInt(c, 10);\n\t\t\tif (isNaN(n)) continue;\n\t\t\tif (null === w || w < n) w = n;\n\t\t}\n\t\treturn w ?? def;\n\t}\n\n\tfunction initFolder(ulBar, btnPos) {\n\t\tlet li = ulBar.querySelector('li.hamburger');\n\t\tif (!li) {\n\t\t\tli = document.createElement('li');\n\t\t\tli.classList.add('hamburger');\n\n\t\t\tif ('end' === btnPos) {\n\t\t\t\tulBar.append(li);\n\t\t\t} else if ('start' === btnPos) {\n\t\t\t\tulBar.prepend(li);\n\t\t\t}\n\t\t}\n\t\tlet btn = li.querySelector('button:first-of-type');\n\t\tif (!btn) {\n\t\t\tbtn = document.createElement('button');\n\t\t\tli.appendChild(btn);\n\t\t}\n\t\tlet ul = li.querySelector('button + ul');\n\t\tif (!ul) {\n\t\t\tul = document.createElement('ul');\n\t\t\tul.classList.add('menu');\n\t\t\tli.appendChild(ul);\n\t\t}\n\t\treturn ul;\n\t}\n\n\tfunction initPopup(ulBar, lis, autoClose) {\n\t\tconst bs = [];\n\t\tfor (const li of lis) {\n\t\t\tconst btn = li.querySelector(':scope > button');\n\t\t\tif (!btn) continue;\n\t\t\tconst popup = btn.nextElementSibling;\n\t\t\tif (!popup) continue;\n\n\t\t\tbtn.setAttribute('area-expanded', 'false');\n\t\t\tif (!popup.id) {\n\t\t\t\tconst id = btn.id ? btn.id : (li.id ? li.id : '');\n\t\t\t\tif (id) {\n\t\t\t\t\tpopup.id = id + '-sub';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (popup.id) {\n\t\t\t\tbtn.setAttribute('area-controls', popup.id);\n\t\t\t}\n\t\t\tbtn.addEventListener('click', (e) => {\n\t\t\t\tif (btn.classList.contains(CLS_OPENED)) {\n\t\t\t\t\tclose(btn);\n\t\t\t\t} else {\n\t\t\t\t\tif (ulBar === li.parentElement) {\n\t\t\t\t\t\tcloseAll(bs, btn);\n\t\t\t\t\t}\n\t\t\t\t\topen(btn);\n\t\t\t\t\tscrollY = window.scrollY;\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t\tbs.push(btn);\n\t\t}\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tif (curBtns.length) {\n\t\t\t\t\tcurBtns[curBtns.length - 1].click();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (autoClose) {\n\t\t\tonScroll(() => doOnScroll(ulBar, bs, scrollY));\n\t\t\tdocument.addEventListener('click', () => closeAll(bs));\n\t\t}\n\t\treturn bs;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction open(btn) {\n\t\tconsole.log('> open');\n\t\tconst li    = btn.parentElement;\n\t\tconst popup = btn.nextElementSibling;\n\t\tif (!popup) return;\n\n\t\tli.classList.add(CLS_OPENED);\n\t\tbtn.classList.add(CLS_OPENED);\n\t\tbtn.setAttribute('area-expanded', 'true');\n\n\t\tpopup.classList.add(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpopup.classList.add(CLS_OPENED);\n\t\t}, 0);\n\t\tcurBtns.push(btn);\n\t\t// console.log('open');\n\t\t// console.log(curBtns);\n\n\t\tstopResize = true;\n\t\tfixBackground(true);\n\t\t// stopResize = false;\n\t}\n\n\tfunction close(btn) {\n\t\tconsole.log('> close');\n\t\tconst li    = btn.parentElement;\n\t\tconst popup = btn.nextElementSibling;\n\t\tif (!popup) return;\n\n\t\tli.classList.remove(CLS_OPENED);\n\t\tbtn.classList.remove(CLS_OPENED);\n\t\tbtn.setAttribute('area-expanded', 'false');\n\n\t\tpopup.classList.remove(CLS_OPENED);\n\t\tsetTimeout(() => {\n\t\t\tpopup.classList.remove(CLS_ACTIVE);\n\t\t}, 200);\n\t\tcurBtns.pop();\n\t\t// console.log('close');\n\t\t// console.log(curBtns);\n\t\tstopResize = true;\n\t\tfixBackground(false);\n\t\t// stopResize = false;\n\t}\n\n\tfunction closeAll(buttons, opening = null) {\n\t\tconsole.log('> closeAll');\n\t\t// console.trace();\n\t\tfor (const btn of buttons) {\n\t\t\tif (opening !== btn) {\n\t\t\t\tclose(btn);\n\t\t\t}\n\t\t}\n\t\tcurBtns.length = 0;\n\t\t// console.log('closeAll');\n\t\t// console.log(curBtns);\n\t\tstopResize = true;\n\t\tfixBackground(false);\n\t\t// stopResize = false;\n\t}\n\n\tfunction doOnScroll(ulBar, buttons, scrollTop) {\n\t\tconst bcr = ulBar.getBoundingClientRect();\n\t\tif (\n\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.scrollY - scrollTop))  // When fixed\n\t\t) {\n\t\t\tcloseAll(buttons);\n\t\t}\n\t}\n\n\tfunction setMaxWidth(root) {\n\t\tconst pref = parseFloat(root.style.getPropertyValue(CP_MAX_WIDTH));\n\n\t\tconst p  = root.parentElement;\n\t\tconst cs = getComputedStyle(p);\n\t\tconst w  = p.clientWidth - (parseFloat(cs.paddingLeft) + parseFloat(cs.paddingRight));\n\t\troot.style.setProperty(CP_MAX_WIDTH, `${Math.floor(w)}px`);\n\t\treturn (isNaN(pref) || pref === w) ? 0 : (pref < w ? 1 : -1);\n\t}\n\n\tfunction alignItems(ws, ulBar, ulFolder, lis, fIdx, order) {\n\t\tulBar.style.width = '0';\n\t\tconst barW = Math.floor(ulBar.parentElement.getBoundingClientRect().width);\n\t\tulBar.style.width = null;\n\n\t\tlet colGap = parseInt(getComputedStyle(ulBar).columnGap, 10);\n\t\tcolGap = Number.isNaN(colGap) ? 0 : colGap;\n\n\t\tconst inBar = calcItemPlace(barW, ws, order, colGap, fIdx);\n\n\t\tif ('false' === getComputedStyle(ulBar).getPropertyValue(CP_FOLDABLE).trim()) {\n\t\t\tinBar.fill(true);\n\t\t\tinBar[fIdx] = false;\n\t\t}\n\t\tlis[fIdx].style.display = inBar[fIdx] ? null : 'none';\n\n\t\tlet prevElm = ulBar.firstChild;\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tconst li = lis[i];\n\t\t\tif (inBar[i]) {\n\t\t\t\tif (li.parentElement === ulBar) {\n\t\t\t\t\tws[i] = li.offsetWidth;\n\t\t\t\t}\n\t\t\t\t// if (li.parentElement !== ulBar) {\n\t\t\t\t// \tconst bs = li.querySelectorAll('button');\n\t\t\t\t// \tfor (const b of bs) b.classList.remove('opened');\n\t\t\t\t// }\n\t\t\t\tulBar.insertBefore(li, prevElm.nextElementSibling);\n\t\t\t\tprevElm = li;\n\t\t\t} else if(i !== fIdx) {\n\t\t\t\t// if (li.parentElement !== ulFolder) {\n\t\t\t\t// \tconst bs = li.querySelectorAll('button');\n\t\t\t\t// \tfor (const b of bs) b.classList.remove('opened');\n\t\t\t\t// }\n\t\t\t\tulFolder.appendChild(li);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction calcItemPlace(ulBarW, ws, order, colGap, fIdx) {\n\t\tconst inBar = new Array(ws.length);\n\t\tconst sumW  = ws.reduce((s, v) => s + v) + (colGap * (ws.length - 1)) - (ws[fIdx] + colGap);\n\n\t\tif (ulBarW < sumW) {\n\t\t\tulBarW -= ws[fIdx];\n\t\t\tinBar[fIdx] = true;\n\n\t\t\tfor (const idx of order) {\n\t\t\t\tif (idx !== fIdx) {\n\t\t\t\t\tulBarW -= ws[idx] + colGap;\n\t\t\t\t\tinBar[idx] = (0 <= ulBarW);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tinBar.fill(true);\n\t\t\tinBar[fIdx] = false;\n\t\t}\n\t\treturn inBar;\n\t}\n\n};\n"]}