{"version":3,"sources":["simplex.js"],"names":["window","id","opts","CLS_ACTIVE","CLS_OPENED","CP_MAX_WIDTH","CP_IS_FOLDABLE","CP_IS_BG_FIXED","root","document","getElementById","getElementsByClassName","ulBar","getElementsByTagName","autoClose","reversed","btnPos","scrollY","curBtns","scrollListeners","onScroll","fn","doFirst","push","isRunning","run","requestAnimationFrame","throttle","addEventListener","l","passive","fixed","fixBackground","enabled","sy","scrollingElement","documentElement","scrollTop","parseInt","body","style","top","cs","getComputedStyle","ss","position","left","width","parseFloat","marginInlineStart","marginInlineEnd","height","key","value","Object","entries","scrollTo","getStylePropertyBool","elm","prop","val","getPropertyValue","trim","length","str","Boolean","JSON","parse","toLowerCase","e","str2bool","ulFolder","li","querySelector","createElement","classList","add","append","prepend","btn","appendChild","ul","initFolder","barLis","Array","from","querySelectorAll","allLis","fIdx","findIndex","contains","buttons","lis","bs","popup","nextElementSibling","setAttribute","close","parentElement","closeAll","open","stopPropagation","focus","click","bcr","getBoundingClientRect","bottom","Math","abs","doOnScroll","initPopup","order","ws","i","getWeightFromClass","sort","a","b","reverse","initOrder","items","clsCurrent","clsHover","clsHoverAncestor","enter","target","pointerType","tagName","leave","remove","it","firstElementChild","addHoverStateEventListener","skipResize","def","className","split","w","c","n","isNaN","setTimeout","map","offsetWidth","rob","ResizeObserver","p","clientWidth","paddingLeft","paddingRight","setProperty","floor","setMaxWidth","barW","display","endsWith","flexGrow","calcBarWidth","colGap","columnGap","Number","inBar","ulBarW","sumW","reduce","s","v","idx","fill","calcItemPlace","prevElm","firstChild","insertBefore","alignItems","observe","focusTrap","transform","adjustPopupInline","maxWidth","pr","rr","right","pop","removeChild","opening","tabIndex"],"mappings":"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","file":"simplex.min.js","sourcesContent":["/**\n * Menu Simplex (Progressively collapsing menu)\n *\n * @author Takuto Yanagida\n * @version 2023-09-21\n */\n\nwindow['menu_simplex'] = function (id = null, opts = {}) {\n\tconst NS = 'menu-simplex';\n\n\tconst CLS_CURRENT = 'current';\n\n\tconst CLS_READY          = 'ready';\n\tconst CLS_HOVER          = 'hover';\n\tconst CLS_HOVER_ANCESTOR = 'hover-ancestor';\n\tconst CLS_ACTIVE         = 'active';\n\tconst CLS_OPENED         = 'opened';\n\n\tconst CP_MAX_WIDTH   = '--max-width';\n\tconst CP_IS_FOLDABLE = '--is-foldable';\n\tconst CP_IS_BG_FIXED = '--is-background-fixed';\n\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\n\tif (!root) return;\n\tconst ulBar = root.getElementsByTagName('ul')[0];\n\tif (!ulBar) return;\n\n\tconst autoClose = opts['autoClose']      ?? true;\n\tconst reversed  = opts['reversed']       ?? false;\n\tconst btnPos    = opts['buttonPosition'] ?? 'end';  // 'start' or 'end';\n\n\tlet scrollY = 0;\n\tlet curBtns = [];\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2023-09-20\n\t */\n\t\n\tconst scrollListeners = [];\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction addHoverStateEventListener(items, clsCurrent, clsHover, root = null, clsHoverAncestor = null) {\n\t\tconst enter = (e) => {\n\t\t\tconst li = e.target.parentElement;\n\t\n\t\t\tif (e.pointerType === 'mouse' && !li.classList.contains(clsCurrent)) {\n\t\t\t\tli.classList.add(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = li.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.tagName === 'LI') {\n\t\t\t\t\t\t\telm.classList.add(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst leave = (e) => {\n\t\t\tconst li = e.target.parentElement;\n\t\n\t\t\tif (e.pointerType === 'mouse' && !li.classList.contains(clsCurrent)) {\n\t\t\t\tli.classList.remove(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = li.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.tagName === 'LI') {\n\t\t\t\t\t\t\telm.classList.remove(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const it of items) {\n\t\t\tit.firstElementChild.addEventListener('pointerenter', enter);\n\t\t\tit.firstElementChild.addEventListener('pointerleave', leave);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tlet fixed = false;\n\t\n\tfunction fixBackground(enabled) {\n\t\tif (fixed === enabled) return;\n\t\tfixed = enabled;\n\t\n\t\tconst scrollingElement = () => {\n\t\t\treturn ('scrollingElement' in document) ? document.scrollingElement : document.documentElement;\n\t\t};\n\t\tconst sy = enabled ? scrollingElement().scrollTop : parseInt(document.body.style.top ?? '0');\n\t\tconst cs = getComputedStyle(document.body);\n\t\tconst mw = parseFloat(cs.marginInlineStart) + parseFloat(cs.marginInlineEnd);\n\t\tconst ss = {\n\t\t\tposition: 'fixed',\n\t\t\ttop     : `${-sy}px`,\n\t\t\tleft    : '0',\n\t\t\twidth   : `calc(100vw - ${mw}px)`,\n\t\t\theight  : '100dvh',\n\t\n\t\t\t'overflow-y': 'scroll',  // For keeping scroll bar width.\n\t\t};\n\t\tfor (const [key, value] of Object.entries(ss)) {\n\t\t\tdocument.body.style[key] = enabled ? value : null;\n\t\t}\n\t\tif (!enabled) {\n\t\t\twindow.scrollTo(0, -sy);\n\t\t}\n\t}\n\t\n\tfunction getStylePropertyBool(elm, prop) {\n\t\tconst val = getComputedStyle(elm).getPropertyValue(prop).trim();\n\t\treturn !val.length ? null : str2bool(val);\n\t}\n\t\n\tfunction str2bool(str){\n\t\tif (typeof str !== 'string') return Boolean(str);\n\t\ttry {\n\t\t\treturn JSON.parse(str.toLowerCase()) == true;\n\t\t} catch(e) {\n\t\t\treturn str.length !== 0;\n\t\t}\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tconst ulFolder = initFolder(ulBar, btnPos);\n\tconst barLis   = Array.from(ulBar.querySelectorAll(':scope > li'));\n\tconst allLis   = Array.from(ulBar.querySelectorAll(':scope li'));\n\tconst fIdx     = barLis.findIndex(e => e.classList.contains('hamburger'));\n\tconst buttons  = initPopup(ulBar, barLis, autoClose);\n\tconst order    = initOrder(barLis, reversed);\n\n\tfor (const li of barLis) {\n\t\tli.addEventListener('click', () => closeAll(buttons));\n\t}\n\taddHoverStateEventListener(allLis, CLS_CURRENT, CLS_HOVER, root, CLS_HOVER_ANCESTOR);\n\n\tlet skipResize = false;\n\n\tlet ws = [];\n\tsetTimeout(() => {\n\t\tws = barLis.map(e => e.offsetWidth);\n\t\tconst rob = new ResizeObserver(() => {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tif (skipResize) {\n\t\t\t\t\tskipResize = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsetMaxWidth(root);\n\t\t\t\tcloseAll(buttons);\n\t\t\t\talignItems(ws, ulBar, ulFolder, barLis, fIdx, order);\n\t\t\t});\n\t\t});\n\t\trob.observe(root);\n\t\trob.observe(root.parentElement);\n\t}, 10);\n\tsetTimeout(() => root.classList.add(CLS_READY), 100);\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initOrder(lis, reversed) {\n\t\tconst ws = new Array(lis.length);\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tws[i] = getWeightFromClass(lis[i], lis.length - i);\n\t\t}\n\t\tconst order = new Array(lis.length);\n\t\tfor (let i = 0; i < lis.length; i += 1) order[i] = i;\n\t\torder.sort((a, b) => ws[a] < ws[b] ? 1 : ws[a] > ws[b] ? -1 : 0);\n\n\t\tif (reversed) {\n\t\t\torder.reverse();\n\t\t}\n\t\treturn order;\n\t}\n\n\tfunction getWeightFromClass(li, def) {\n\t\tconst cs = li.className.split(' ');\n\t\tlet w = null;\n\t\tfor (const c of cs) {\n\t\t\tconst n = parseInt(c, 10);\n\t\t\tif (isNaN(n)) continue;\n\t\t\tif (null === w || w < n) w = n;\n\t\t}\n\t\treturn w ?? def;\n\t}\n\n\tfunction initFolder(ulBar, btnPos) {\n\t\tlet li = ulBar.querySelector('li.hamburger');\n\t\tif (!li) {\n\t\t\tli = document.createElement('li');\n\t\t\tli.classList.add('hamburger');\n\n\t\t\tif ('end' === btnPos) {\n\t\t\t\tulBar.append(li);\n\t\t\t} else if ('start' === btnPos) {\n\t\t\t\tulBar.prepend(li);\n\t\t\t}\n\t\t}\n\t\tlet btn = li.querySelector('button:first-of-type');\n\t\tif (!btn) {\n\t\t\tbtn = document.createElement('button');\n\t\t\tli.appendChild(btn);\n\t\t}\n\t\tlet ul = li.querySelector('button + ul');\n\t\tif (!ul) {\n\t\t\tul = document.createElement('ul');\n\t\t\tul.classList.add('menu');\n\t\t\tli.appendChild(ul);\n\t\t}\n\t\treturn ul;\n\t}\n\n\tfunction initPopup(ulBar, lis, autoClose) {\n\t\tconst bs = [];\n\t\tfor (const li of lis) {\n\t\t\tconst btn = li.querySelector(':scope > button');\n\t\t\tif (!btn) continue;\n\t\t\tconst popup = btn.nextElementSibling;\n\t\t\tif (!popup) continue;\n\n\t\t\tbtn.setAttribute('area-expanded', 'false');\n\t\t\tif (!popup.id) {\n\t\t\t\tconst id = btn.id ? btn.id : (li.id ? li.id : '');\n\t\t\t\tif (id) {\n\t\t\t\t\tpopup.id = id + '-sub';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (popup.id) {\n\t\t\t\tbtn.setAttribute('area-controls', popup.id);\n\t\t\t}\n\t\t\tbtn.addEventListener('click', (e) => {\n\t\t\t\tif (btn.classList.contains(CLS_OPENED)) {\n\t\t\t\t\tclose(btn);\n\t\t\t\t} else {\n\t\t\t\t\tif (ulBar === li.parentElement) {\n\t\t\t\t\t\tcloseAll(bs, btn);\n\t\t\t\t\t}\n\t\t\t\t\topen(btn);\n\t\t\t\t\tscrollY = window.scrollY;\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t\tbs.push(btn);\n\t\t}\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tif (curBtns.length) {\n\t\t\t\t\tcurBtns[curBtns.length - 1].focus();\n\t\t\t\t\tcurBtns[curBtns.length - 1].click();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (autoClose) {\n\t\t\tonScroll(() => doOnScroll(ulBar, bs, scrollY));\n\t\t\tdocument.addEventListener('click', () => closeAll(bs));\n\t\t}\n\t\treturn bs;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tconst focusTrap = document.createElement('li');\n\tfocusTrap.className = 'focus-trap';\n\tfocusTrap.tabIndex = 0;\n\tfocusTrap.addEventListener('focus', () => {\n\t\tif (curBtns.length) {\n\t\t\tcurBtns[0].focus();\n\t\t}\n\t});\n\n\tfunction open(btn) {\n\t\tconst li    = btn.parentElement;\n\t\tconst popup = btn.nextElementSibling;\n\t\tif (!popup) return;\n\n\t\tli.classList.add(CLS_OPENED);\n\t\tbtn.classList.add(CLS_OPENED);\n\t\tbtn.setAttribute('area-expanded', 'true');\n\n\t\tpopup.classList.add(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpopup.classList.add(CLS_OPENED);\n\t\t}, 0);\n\t\tcurBtns.push(btn);\n\t\tpopup.style.transform = null;\n\t\tadjustPopupInline(curBtns[0].nextElementSibling);\n\n\t\tif (1 === curBtns.length) {\n\t\t\tconst ul = ('UL' === popup.tagName) ? popup : popup.getElementsByClassName('UL')?.[0];\n\t\t\tif (ul) {\n\t\t\t\tul.appendChild(focusTrap);\n\t\t\t}\n\t\t}\n\n\t\tif (true === getStylePropertyBool(root, CP_IS_BG_FIXED)) {\n\t\t\tskipResize = true;\n\t\t\tfixBackground(true);\n\t\t}\n\t}\n\n\tfunction adjustPopupInline(popup) {\n\t\tpopup.style.transform = null;\n\t\tpopup.style.maxWidth = null;\n\t\tlet pr = popup.getBoundingClientRect();\n\t\tconst rr = root.getBoundingClientRect();\n\t\tif (rr.width < pr.width) {\n\t\t\tpopup.style.maxWidth = `${rr.width}px`;\n\t\t\tpr = popup.getBoundingClientRect();\n\t\t}\n\t\tif (rr.right < pr.right) {\n\t\t\tpopup.style.transform = `translateX(${rr.right - pr.right}px)`;\n\t\t}\n\t\tif (pr.left < rr.left) {\n\t\t\tpopup.style.transform = `translateX(${pr.left - rr.left}px)`;\n\t\t}\n\t}\n\n\tfunction close(btn) {\n\t\tconst li    = btn.parentElement;\n\t\tconst popup = btn.nextElementSibling;\n\t\tif (!popup) return;\n\n\t\tli.classList.remove(CLS_OPENED);\n\t\tbtn.classList.remove(CLS_OPENED);\n\t\tbtn.setAttribute('area-expanded', 'false');\n\n\t\tpopup.classList.remove(CLS_OPENED);\n\t\tsetTimeout(() => {\n\t\t\tpopup.classList.remove(CLS_ACTIVE);\n\t\t\tif (curBtns.length) adjustPopupInline(curBtns[0].nextElementSibling);\n\t\t}, 200);\n\t\tcurBtns.pop();\n\n\t\tif (0 === curBtns.length) {\n\t\t\tconst ul = ('UL' === popup.tagName) ? popup : popup.getElementsByClassName('UL')?.[0];\n\t\t\tif (ul && focusTrap.parentElement === ul) {\n\t\t\t\tul.removeChild(focusTrap);\n\t\t\t}\n\t\t}\n\n\t\tif (getStylePropertyBool(root, CP_IS_BG_FIXED)) {\n\t\t\tskipResize = true;\n\t\t\tfixBackground(false);\n\t\t}\n\t}\n\n\tfunction closeAll(buttons, opening = null) {\n\t\tfor (const btn of buttons) {\n\t\t\tif (opening !== btn) {\n\t\t\t\tclose(btn);\n\t\t\t}\n\t\t}\n\t\tcurBtns.length = 0;\n\n\t\tif (getStylePropertyBool(root, CP_IS_BG_FIXED)) {\n\t\t\tskipResize = true;\n\t\t\tfixBackground(false);\n\t\t}\n\t}\n\n\tfunction doOnScroll(ulBar, buttons, scrollTop) {\n\t\tif (!curBtns.length || !curBtns[0].nextElementSibling) {\n\t\t\treturn;\n\t\t}\n\t\tconst bcr = curBtns[0].nextElementSibling.getBoundingClientRect();\n\t\tif (\n\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.scrollY - scrollTop))  // When fixed\n\t\t) {\n\t\t\tcloseAll(buttons);\n\t\t}\n\t}\n\n\tfunction setMaxWidth(root) {\n\t\tconst p  = root.parentElement;\n\t\tconst cs = getComputedStyle(p);\n\t\tconst w  = p.clientWidth - (parseFloat(cs.paddingLeft) + parseFloat(cs.paddingRight));\n\t\troot.style.setProperty(CP_MAX_WIDTH, `${Math.floor(w)}px`);\n\t}\n\n\tfunction alignItems(ws, ulBar, ulFolder, lis, fIdx, order) {\n\t\tconst barW = calcBarWidth(ulBar);\n\t\tlet colGap = parseInt(getComputedStyle(ulBar).columnGap, 10);\n\t\tcolGap = Number.isNaN(colGap) ? 0 : colGap;\n\n\t\tconst inBar = calcItemPlace(barW, ws, order, colGap, fIdx);\n\n\t\tif (false === getStylePropertyBool(root, CP_IS_FOLDABLE)) {\n\t\t\tinBar.fill(true);\n\t\t\tinBar[fIdx] = false;\n\t\t}\n\t\tlis[fIdx].style.display = inBar[fIdx] ? null : 'none';\n\n\t\tlet prevElm = ulBar.firstChild;\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tconst li = lis[i];\n\t\t\tif (inBar[i]) {\n\t\t\t\tif (li.parentElement === ulBar) {\n\t\t\t\t\tws[i] = li.offsetWidth;\n\t\t\t\t}\n\t\t\t\tulBar.insertBefore(li, prevElm.nextElementSibling);\n\t\t\t\tprevElm = li;\n\t\t\t} else if(i !== fIdx) {\n\t\t\t\tulFolder.appendChild(li);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction calcBarWidth(ulBar) {\n\t\tulBar.style.width = '0';\n\t\tlet barW = Math.floor(root.getBoundingClientRect().width);\n\t\tif (barW === 0 && root.parentElement) {\n\t\t\tconst rps = getComputedStyle(root.parentElement);\n\t\t\tif (rps.display.endsWith('flex')) {\n\t\t\t\troot.style.flexGrow = 1;\n\t\t\t\tbarW = Math.floor(root.getBoundingClientRect().width);\n\t\t\t\troot.style.flexGrow = null;\n\t\t\t}\n\t\t}\n\t\tulBar.style.width = null;\n\t\treturn barW;\n\t}\n\n\tfunction calcItemPlace(ulBarW, ws, order, colGap, fIdx) {\n\t\tconst inBar = new Array(ws.length);\n\t\tconst sumW  = ws.reduce((s, v) => s + v) + (colGap * (ws.length - 1)) - (ws[fIdx] + colGap);\n\n\t\tif (ulBarW < sumW) {\n\t\t\tulBarW -= ws[fIdx];\n\t\t\tinBar[fIdx] = true;\n\n\t\t\tfor (const idx of order) {\n\t\t\t\tif (idx !== fIdx) {\n\t\t\t\t\tulBarW -= ws[idx] + colGap;\n\t\t\t\t\tinBar[idx] = (0 <= ulBarW);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tinBar.fill(true);\n\t\t\tinBar[fIdx] = false;\n\t\t}\n\t\treturn inBar;\n\t}\n\n};\n"]}